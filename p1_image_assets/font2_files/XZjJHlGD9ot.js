if (self.CavalryLogger) { CavalryLogger.start_js(["vMIBI"]); }

__d("SphericalPhotoConstants",[],(function a(b,c,d,e,f,g){f.exports={QE_ALL_UNIVERSE:"spherical_photo",QE_WWW_UNIVERSE:"spherical_photo_www_universe",QE_WWW_COMPOSER_UNIVERSE:"spherical_photo_www_composer_universe",FEED_TRACKING_KEY:"spherical_photo_interaction"}}),null);
__d("SphericalMediaCoreActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";var h={turnOn:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").TURN_ON}},turnOff:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").TURN_OFF}},enableSpherical:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").ENABLE_SPHERICAL}},disableSpherical:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").DISABLE_SPHERICAL}}};f.exports=h}),null);
__d("SphericalMediaViewActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";f.exports={updateView:function h(i){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_VIEW,data:i}},updateViewport:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_VIEWPORT,data:{yaw:i,pitch:j}}},updateFOV:function h(i){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_FOV,data:{fov:i}}},updateViewportAndFOV:function h(i,j,k){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV,data:{yaw:i,pitch:j,fov:k}}},startAnimating:function h(){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").START_ANIMATING}},stopAnimating:function h(){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").STOP_ANIMATING}}}}),null);
__d("SphericalMediaController.react",["cx","Event","React","SphericalViewportControl","SubscriptionsHandler","debounce","getElementRect","performanceNow","throttle","SphericalMediaConstants"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalMediaConstants").GYRO_SLIP_FACTOR,l=c("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_DEGREE,m=c("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_MS,n=c("SphericalMediaConstants").RB_FRICTION,o=c("SphericalMediaConstants").RB_SPRING_FACTOR,p=c("SphericalMediaConstants").RB_MAX_SPRING_DEGREE,q=c("SphericalMediaConstants").RB_MAX_STRETCH_X_DEGREE,r=c("SphericalMediaConstants").RB_MAX_STRETCH_Y_DEGREE,s=c("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE;i=babelHelpers.inherits(t,c("React").Component);j=i&&i.prototype;function t(u){__p&&__p();j.constructor.call(this,u);this.$SphericalMediaController3=0;this.$SphericalMediaController5=false;this.onViewChange=function(){var v=this.__sphericalViewportControl;if(v&&!v.isUpdating()){var w=this.__getViewData(),x=v.getOrientation(),y=v.getVerticalFieldOfView(),z=w.fov!==y||w.pitch!==x.y||w.yaw!==x.x;if(z){v.updateViewport(w.yaw,w.pitch,w.fov);this.$SphericalMediaController4=babelHelpers["extends"]({},w)}}}.bind(this);this.$SphericalMediaController6=function(){if(!this.__viewport)return;var v=c("getElementRect")(this.__viewport);if(v.left!==0||v.right!==0||v.top!==0||v.bottom!==0||v.height!==0||v.width!==0)this.$SphericalMediaController1={x:v.left,y:v.top}}.bind(this);this.$SphericalMediaController2=new(c("SubscriptionsHandler"))();this.$SphericalMediaController2.addSubscriptions(c("Event").listen(window,"resize",c("debounce")(this.$SphericalMediaController6)))}t.prototype.componentWillReceiveProps=function(u){if(u.isActive!==this.props.isActive&&!u.isActive)this.$SphericalMediaController7();if(u.isActive)if(u.width!==this.props.width||u.height!==this.props.height)this.$SphericalMediaController8(u.width,u.height)};t.prototype.componentDidMount=function(){this.props.isActive&&this.$SphericalMediaController9()};t.prototype.shouldComponentUpdate=function(u){var v=u.isActive&&!this.__sphericalViewportControl||u.width!==this.props.width||u.height!==this.props.height;return v};t.prototype.componentDidUpdate=function(){if(this.props.isActive&&!this.__sphericalViewportControl)this.$SphericalMediaController9();this.$SphericalMediaController6()};t.prototype.componentWillUnmount=function(){this.$SphericalMediaController7()};t.prototype.$SphericalMediaController9=function(){__p&&__p();var u=void 0;if(!this.__viewport)return;u=this.__viewport;var v=this.__getSphericalConfig(this.props),w=new(c("SphericalViewportControl"))(u,v,this.$SphericalMediaController10(),this.props.showNewPhotoRenderer);this.$SphericalMediaController4={fov:v.fieldOfView,pitch:v.initialPitch,yaw:v.initialHeading};this.$SphericalMediaController6();w.addListener("updateViewportBegin",this.__onUpdateViewportBegin);w.addListener("updateViewportMoveStart",this.__onUpdateViewportMoveStart);w.addListener("DOM/click",this.__onDOMClick);w.addListener("updateViewportEnd",function(x,y){this.__onUpdateViewportEnd();this.$SphericalMediaController11()}.bind(this));w.addListener("initialViewportChange",this.__onInitialViewportChange);w.addListener("viewportChange",this.__onViewportChange);w.addListener("zoomStart",this.__onZoomStart);w.addListener("mouseEnter",this.__onMouseEnter);w.addListener("mouseMove",c("throttle")(this.__onMouseMove));if(this.props.showNewPhotoRenderer&&this.props.initialFov>179)w.setInitialOrientation();this.__sphericalViewportControl=w;this.$SphericalMediaController8(this.props.width,this.props.height)};t.prototype.$SphericalMediaController7=function(){this.$SphericalMediaController2.release();this.__sphericalViewportControl&&this.__sphericalViewportControl.destroy();this.__sphericalViewportControl=null;this.$SphericalMediaController5=true};t.prototype.$SphericalMediaController11=function(){__p&&__p();var u=c("performanceNow")();if(Math.abs(u-this.$SphericalMediaController3)<m)return;var v=this.$SphericalMediaController4;if(!v)return;var w=this.__getViewData(),x=w.yaw-v.yaw,y=w.pitch-v.pitch,z=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));if(l<z){this.__onSignificantMove(w);this.$SphericalMediaController3=u;this.$SphericalMediaController4=babelHelpers["extends"]({},w)}};t.prototype.$SphericalMediaController8=function(u,v,w){__p&&__p();var x=this.__sphericalViewportControl;if(x){x.updateViewportClientSize({width:u,height:v});if(this.props.maxTileLevel>0){var y=Math.pow(2,this.props.maxTileLevel),z=s*y/90,A=v/z/3;x.updateMinVFOV(A)}var B=this.__getViewData();x.setFieldOfView(B.fov);var C=x.getVerticalFieldOfView();if(C!==B.fov)this.__updateFOV(C)}};t.prototype.$SphericalMediaController10=function(){return{disableAutoClientSizeUpdate:true,enableGyro:this.props.enableGyro,enableRubberBanding:this.props.enableRubberBanding,maxSpringDegrees:p,maxStretchXDegrees:q,maxStretchYDegrees:r,minVFOV:this.props.maxTileLevel,rubberBandConstant:n,slipFactor:k,springFactor:o}};t.prototype.__getSphericalConfig=function(u){var v=this.__getPartialLimits(u),w=u.initialYaw,x=u.initialPitch,y=u.initialFov;if(this.$SphericalMediaController5){var z=this.__getViewData();y=z.fov;x=z.pitch;w=z.yaw}return{initialHeading:w,initialPitch:x,fieldOfView:y,keyboardVelocityFactor:u.keyboardVelocityFactor,panningVelocityFactor:u.panningVelocityFactor,enableZoom:u.enableZoom,partialLimits:v||undefined}};t.prototype.__getPartialLimits=function(u){if(u.partialLeftDegrees||u.partialRightDegrees||u.partialTopDegrees||u.partialBottomDegrees)return{partialLeftDegrees:u.partialLeftDegrees,partialRightDegrees:u.partialRightDegrees,partialTopDegrees:u.partialTopDegrees,partialBottomDegrees:u.partialBottomDegrees};return null};t.prototype.__getViewportMousePosition=function(u){if(!this.$SphericalMediaController1){this.$SphericalMediaController6();if(!this.$SphericalMediaController1)return null}return{x:(u.clientX||u.changedTouches[0].clientX)-this.$SphericalMediaController1.x,y:(u.clientY||u.changedTouches[0].clientY)-this.$SphericalMediaController1.y}};t.prototype.__changeCursorStyle=function(u){if(!this.__viewport)return;this.__viewport.style.cursor=u};t.prototype.render=function(){return c("React").createElement("div",{ref:function(u){return this.__viewport=u}.bind(this),className:"_5nxw _25i_"+(!this.props.isActive?" hidden_elem":""),tabIndex:0,"aria-label":this.props.caption})};f.exports=t}),null);
__d("SphericalMediaRenderer.react",["cx","DOM","BackgroundImage.react","React","SphericalPhotoConfig"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("React").Component);j=i&&i.prototype;function k(l){j.constructor.call(this,l);this.$SphericalMediaRenderer2=false;this.$SphericalMediaRenderer3=false;if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var m in this.constructor.__subClassMethods)if(typeof this[m]!=="function")throw new Error('Must implement "'+m+'"')}k.prototype.componentWillReceiveProps=function(l){if(!l.isActive&&this.sphericalRenderer){this.__destroy();return}};k.prototype.shouldComponentUpdate=function(l){return this.shouldRender};k.prototype.componentDidMount=function(){this.$SphericalMediaRenderer4()};k.prototype.componentWillUnmount=function(){this.__destroy()};k.prototype.__destroy=function(){this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null};k.prototype.$SphericalMediaRenderer4=function(){__p&&__p();if(this.$SphericalMediaRenderer2||!this.__isReadyToSetup()||!this.$SphericalMediaRenderer1||this.$SphericalMediaRenderer3)return;this.$SphericalMediaRenderer3=true;var l=this.__getCanvas();this.__getRenderer(l).done(function(m){__p&&__p();m.updateViewportDimensions(this.props.width,this.props.height);m.addListener("renderingError",function(n,o){return this.__onWebGlRenderFailed(n,o)}.bind(this));m.addListener("renderingContextLost",function(){return this.__onWebGlContextLost()}.bind(this));c("DOM").setContent(this.$SphericalMediaRenderer1,l);this.sphericalRenderer=m;m.renderErrorCheck();this.$SphericalMediaRenderer3=false;this.__onSetupDone(m)}.bind(this),function(m){this.$SphericalMediaRenderer2=true;this.$SphericalMediaRenderer3=false;this.__onWebGlInitFailed(m);return}.bind(this))};k.prototype.draw=function(l){__p&&__p();if(!this.sphericalRenderer)return;var m=this.sphericalRenderer;if(!m)return;try{m.render(l);this.__afterDraw(m)}catch(n){this.__onWebGlRenderFailed(n,l);return}};k.prototype.componentDidUpdate=function(){if(!this.props.isActive)return;var l=this.sphericalRenderer;if(!l)this.$SphericalMediaRenderer4();else{l.updateViewportDimensions(this.props.width,this.props.height);this.draw(this.__getViewData())}};k.prototype.render=function(){var l=void 0,m=this.props.fallback;if(c("SphericalPhotoConfig").show_fallback_ui&&m&&this.props.showFallbackUI&&!c("SphericalPhotoConfig").show_fallback_ui_simple)return c("React").createElement("div",{className:"_183d",onClick:function(){return this.__onFallbackUIClick()}.bind(this),role:"link",tabIndex:"0"},c("React").createElement(c("BackgroundImage.react"),{className:"_183e",src:m.imageURI,width:this.props.width,height:this.props.height,backgroundSize:"contain"}));if(this.props.thumbnail)l=c("React").createElement(c("BackgroundImage.react"),{className:!this.__showLoadingThumbnail()||this.props.isActive&&this.sphericalRenderer?"hidden_elem":"",src:this.props.thumbnail,width:this.props.width,height:this.props.height,backgroundSize:"cover"});return c("React").createElement("div",{className:"_4trl"},c("React").createElement("div",{className:(!this.props.isActive||!this.sphericalRenderer?"hidden_elem":"")+" _4trl",ref:function(n){return this.$SphericalMediaRenderer1=n}.bind(this)}),l)};f.exports=k}),null);
__d("PhotoRendererProjection",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({PERSPECTIVE:"perspective",CYLINDRICAL:"cylindrical",EQUIRECTANGULAR:"equirectangular"})}),null);
__d("PhotoProjection",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({EQUIRECTANGULAR:"equirectangular",CUBESTRIP:"cubestrip",CYLINDRICAL:"cylindrical",TILED_CUBEMAP:"tiled_cubemap"})}),null);
__d("SphericalMediaBaseStore",["ReduxThunk","Redux"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("Redux").compose,i=c("Redux").applyMiddleware,j=c("Redux").createStore,k=c("Redux").combineReducers;function l(){var m=arguments.length<=0||arguments[0]===undefined?[]:arguments[0],n=i.apply(undefined,[c("ReduxThunk")].concat(m)),o=k(this.getReducers());this.$SphericalMediaBaseStore1=h(n)(j)(o)}l.prototype.getStore=function(){return this.$SphericalMediaBaseStore1};l.prototype.getReducers=function(){throw new Error("Implement _getReducers")};f.exports=l}),null);
__d("SphericalMediaViewReducer",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={fov:65,pitch:0,yaw:0,isAnimating:false},i=function i(){__p&&__p();var j=arguments.length<=0||arguments[0]===undefined?h:arguments[0],k=arguments[1];if(k.namespace!==c("SphericalMediaActionNamespaces").VIEW)return j;var l={};switch(k.type){case c("SphericalMediaActions").UPDATE_VIEW:l=k.data;break;case c("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV:var m=k.data,n=m.pitch,o=m.fov,p=m.yaw;if(!isNaN(n+o+p)){l.fov=o;l.pitch=n;l.yaw=p}break;case c("SphericalMediaActions").UPDATE_VIEWPORT:l=k.data;break;case c("SphericalMediaActions").UPDATE_FOV:l.fov=k.data.fov;break;case c("SphericalMediaActions").START_ANIMATING:l.isAnimating=true;break;case c("SphericalMediaActions").STOP_ANIMATING:l.isAnimating=false;break}return babelHelpers["extends"]({},j,l)};f.exports=i}),null);
__d("SphericalMediaViewStore",["SphericalMediaBaseStore","SphericalMediaViewReducer"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("SphericalMediaBaseStore"));i=h&&h.prototype;j.prototype.getReducers=function(){return{view:c("SphericalMediaViewReducer")}};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("SphericalMediaBaseRecord",["PhotoProjection","immutable","SphericalMediaViewStore"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("PhotoProjection").CUBESTRIP,k=c("immutable").Record({keyboardVelocityFactor:0,panningVelocityFactor:0,enableGyro:false,enablePartialLimit:false,enableRubberBanding:false,enableZoom:false,showFallbackUI:false,useFallbackUI:false,useLargeHeadingIndicator:false,partialLeftDegrees:undefined,partialRightDegrees:undefined,partialTopDegrees:undefined,partialBottomDegrees:undefined,isPanning:false,hasInteracted:false,visibility:true,aspectRatio:1,height:0,width:0,initialFov:65,initialPitch:0,initialYaw:0,renderer:null,isRendererActive:false,isRendererSetup:false,className:"",projectionType:j,expansionCoef:undefined,tiledSphericalConfig:{useTiledRenderer:false,initialTileUris:[],viewportTileUris:[],maxTileLevel:0},canvasNamespace:"SphericalMedia",caption:"",type:"photo",src:"",flatImage:"",originalImageURI:"",thumbnail:"",fbid:"",loaded:false,enableSpherical:true,isFetchingData:false,photoSphereMetadata:{},exif:{},useLocalSphericalImage:false,fallback:null,fallbackCTAElement:null,enableTagging:false,tags:[],tagUnderMouse:null,tagClicked:null,isTagging:false,tagger:null,taggingMode:false,targetedTag:null,sourceProjectionType:null,surface:"",sessionID:"",viewStore:new(c("SphericalMediaViewStore"))().getStore(),ctrElement:null});h=babelHelpers.inherits(l,k);i=h&&h.prototype;function l(){h.apply(this,arguments)}f.exports=l}),null);
__d("SphericalMediaBaseReducer",["SphericalMediaActionNamespaces","SphericalMediaActions","SphericalMediaBaseRecord","SphericalMediaViewStore","PhotoRendererProjection"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=function h(){return new(c("SphericalMediaBaseRecord"))({viewStore:new(c("SphericalMediaViewStore"))().getStore()})},i=function i(){__p&&__p();var j=arguments.length<=0||arguments[0]===undefined?h():arguments[0],k=arguments[1];if(k.namespace!==c("SphericalMediaActionNamespaces").CORE&&k.namespace!==c("SphericalMediaActionNamespaces").BASE)return j;switch(k.type){case c("SphericalMediaActions").UPDATE_BASE:var l=k.data;return j.withMutations(function(D){__p&&__p();D.merge(l);if(l.photoSphereMetadata)D.set("photoSphereMetadata",l.photoSphereMetadata);if(l.tiledSphericalConfig)D.set("tiledSphericalConfig",l.tiledSphericalConfig);if(l.tags)D.set("tags",l.tags);if(l.tagUnderMouse)D.set("tagUnderMouse",l.tagUnderMouse);if(l.tagClicked)D.set("tagClicked",l.tagClicked);if(l.tagger)D.set("tagger",l.tagger);if(l.exif)D.set("exif",l.exif);if(l.fallback)D.set("fallback",l.fallback)});case c("SphericalMediaActions").DRAG_START:return j.withMutations(function(D){D.set("isPanning",true);D.set("hasInteracted",true)});case c("SphericalMediaActions").VISIBILITY_CHANGED:return j.set("visibility",k.data);case c("SphericalMediaActions").UPDATE_INITIAL_FOV:return j.set("initialFov",k.data.initialFov);case c("SphericalMediaActions").UPDATE_INITIAL_VIEWPORT:var m=k.data;return j.withMutations(function(D){D.set("initialYaw",m.initialYaw);D.set("initialPitch",m.initialPitch)});case c("SphericalMediaActions").UPDATE_DIMENSION:var n=k.data;return j.withMutations(function(D){D.set("height",n.height);D.set("width",n.width);D.set("aspectRatio",n.width/n.height)});case c("SphericalMediaActions").SETUP_RENDERER:var o=k.data.renderer;return j.withMutations(function(D){D.set("isRendererSetup",true);D.set("renderer",o)});case c("SphericalMediaActions").TURN_ON:return j.set("isRendererActive",true);case c("SphericalMediaActions").TURN_OFF:return j.withMutations(function(D){D.set("isRendererActive",false);D.set("isRendererSetup",false);D.set("renderer",null)});case c("SphericalMediaActions").REPLACE_BASE_STATE:return k.data;case c("SphericalMediaActions").SOURCE_ONLOAD:return j.set("loaded",true);case c("SphericalMediaActions").DISABLE_SPHERICAL:return j.set("enableSpherical",false);case c("SphericalMediaActions").ENABLE_SPHERICAL:return j.set("enableSpherical",true);case c("SphericalMediaActions").REQUEST_PHOTO:return j.withMutations(function(D){D.set("loaded",false);D.set("isFetchingData",true)});case c("SphericalMediaActions").RECEIVE_PHOTO:var p=k.data,q=p.partialLimits,r=p.photoSphereMetadata||{};return j.withMutations(function(D){__p&&__p();D.set("fbid",p.photoID);D.set("flatImage",p.flatImage);D.set("initialFov",p.initialFov);D.set("initialPitch",p.initialPitch);D.set("initialYaw",p.initialYaw);D.set("isFetchingData",false);D.set("originalImageURI",p.originalImageURI);D.set("partialBottomDegrees",q.partialBottomDegrees);D.set("partialLeftDegrees",q.partialLeftDegrees);D.set("partialRightDegrees",q.partialRightDegrees);D.set("partialTopDegrees",q.partialTopDegrees);D.set("sourceProjectionType",r.ProjectionType);D.set("src",p.src);D.set("thumbnail",p.thumbnail);D.set("photoSphereMetadata",r);if(r&&(r.RendererProjectionType===c("PhotoRendererProjection").CYLINDRICAL||r.RendererProjectionType===c("PhotoRendererProjection").EQUIRECTANGULAR))D.set("enableSpherical",false)});case c("SphericalMediaActions").UPDATE_CTR_ELEM:return j.set("ctrElement",k.data.element);case c("SphericalMediaActions").ENABLE_TAGGING:return j.set("enableTagging",true);case c("SphericalMediaActions").DISABLE_TAGGING:return j.set("enableTagging",false);case c("SphericalMediaActions").UPDATE_SPATIAL_TAGS_FROM_COMPOSER:case c("SphericalMediaActions").UPDATE_SPATIAL_TAGS:var s=k.data;return j.withMutations(function(D){D.set("tags",s)});case c("SphericalMediaActions").UPDATE_TAG_UNDER_MOUSE:var t=k.data;return j.withMutations(function(D){D.set("tagUnderMouse",t)});case c("SphericalMediaActions").CANVAS_RESIZE_SUCCESS:var u=k.data;return j.withMutations(function(D){D.set("src",u)});case c("SphericalMediaActions").TAGGING_START:return j.set("isTagging",true);case c("SphericalMediaActions").TAGGING_STOP:return j.set("isTagging",false);case c("SphericalMediaActions").UPDATE_TAG_CLICKED:var v=k.data;return j.withMutations(function(D){D.set("tagClicked",v)});case c("SphericalMediaActions").UPDATE_TAGGER:var w=k.data;return j.withMutations(function(D){D.set("tagger",w)});case c("SphericalMediaActions").ENTER_TAGGING_MODE:return j.set("taggingMode",true);case c("SphericalMediaActions").EXIT_TAGGING_MODE:return j.set("taggingMode",false);case c("SphericalMediaActions").UPDATE_TARGETED_TAG:var x=k.data;return j.withMutations(function(D){D.set("targetedTag",x)});case c("SphericalMediaActions").SHOW_FALLBACK:return j.set("showFallbackUI",true);case c("SphericalMediaActions").USE_FALLBACK:return j.set("useFallbackUI",true);case c("SphericalMediaActions").UPDATE_PARTIAL_LIMITS:var y=k.data,z=y.partialTopDegrees,A=y.partialBottomDegrees,B=y.partialRightDegrees,C=y.partialLeftDegrees;return j.withMutations(function(D){D.set("partialBottomDegrees",A);D.set("partialLeftDegrees",C);D.set("partialRightDegrees",B);D.set("partialTopDegrees",z)})}return j};f.exports=i}),null);
__d("SphericalPhotoActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";f.exports={rendererStats:function h(i){return{namespace:c("SphericalMediaActionNamespaces").PHOTO,type:c("SphericalMediaActions").PHOTO_RENDERER_STATS,data:i}}}}),null);
__d("SphericalMediaTaggingUtils",["GLMatrix","SphericalPhotoProjectionUtils","SphericalProjectionUtils","degToRad","radToDeg"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("GLMatrix").vec3,i={getSpatialTagArea:function j(k,l,m){var n=m.h/l.fov,o={w:Math.abs(k.width_degree)*n,h:Math.abs(k.height_degree)*n},p=c("SphericalProjectionUtils").convert3dTo2dScaledUnique(k.center.yaw,k.center.pitch,l.yaw,l.pitch,l.fov,m.w,m.h);return{topLeft:{x:p.x-o.w/2,y:p.y-o.h/2},bottomRight:{x:p.x+o.w/2,y:p.y+o.h/2}}},getSpatialTagAreaInNewPhotoRenderer:function j(k,l,m,n){var o=m.h/l.fov,p={w:Math.abs(k.width_degree)*o,h:Math.abs(k.height_degree)*o},q=c("SphericalPhotoProjectionUtils").convert3dTo2d(k.center.yaw,k.center.pitch,l,m.w,m.h,n);return{topLeft:{x:q.x-p.w/2,y:q.y-p.h/2},bottomRight:{x:q.x+p.w/2,y:q.y+p.h/2}}},isPointInTagArea:function j(k,l,m,n){var o=i.getSpatialTagArea(l,m,n);return!(o.topLeft.x>k.x||o.bottomRight.x<k.x||o.topLeft.y>k.y||o.bottomRight.y<k.y)},isPointInTagAreaInNewPhotoRenderer:function j(k,l,m,n,o){var p=i.getSpatialTagAreaInNewPhotoRenderer(l,m,n,o);return!(p.topLeft.x>k.x||p.bottomRight.x<k.x||p.topLeft.y>k.y||p.bottomRight.y<k.y)},pointsToRectSize:function j(k){var l=k.topLeft,m=k.bottomRight;return{w:Math.abs(m.x-l.x),h:Math.abs(m.y-l.y)}},rectSizeToPoints:function j(k,l){return{topLeft:k,bottomRight:{x:k.x+Math.abs(l.w),y:k.y+Math.abs(l.h)}}},rectSizeToDegreeSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return{widthDegree:k/o*360,heightDegree:l/n*180}},degreeSizeToRectSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return{w:k/360*o,h:l/180*n}},yawPitchToPhotoXY:function j(k,l,m){var n=Number(m.PosePitchDegrees),o=Number(m.PoseRollDegrees),p=Number(m.CroppedAreaImageHeightPixels),q=Number(m.CroppedAreaImageWidthPixels),r=Number(m.CroppedAreaLeftPixels),s=Number(m.CroppedAreaTopPixels),t=Number(m.FullPanoHeightPixels),u=Number(m.FullPanoWidthPixels),v=i.yawPitchToVec3(k,l),w=[v.x,v.y,v.z];if(n!==0)h.rotateX(w,w,[0,0,0],c("degToRad")(-n));if(o!==0)h.rotateZ(w,w,[0,0,0],c("degToRad")(o));var x=i.vec3ToPhotoXY(w[0],w[1],w[2]),y=x.x*u-r,z=x.y*t-s,A=y/q,B=z/p;return{x:A,y:B}},photoXYToYawPitch:function j(k,l){var m=Number(l.PosePitchDegrees),n=Number(l.PoseRollDegrees),o=Number(l.CroppedAreaImageHeightPixels),p=Number(l.CroppedAreaImageWidthPixels),q=Number(l.CroppedAreaLeftPixels),r=Number(l.CroppedAreaTopPixels),s=Number(l.FullPanoHeightPixels),t=Number(l.FullPanoWidthPixels),u=k.x*p,v=k.y*o,w=(u+q)/t,x=(v+r)/s,y=i.photoXYToVec3(w,x),z=[y.x,y.y,y.z];if(n!==0)h.rotateZ(z,z,[0,0,0],c("degToRad")(-n));if(m!==0)h.rotateX(z,z,[0,0,0],c("degToRad")(m));return i.vec3ToYawPitch.apply(i,z)},yawPitchToVec3:function j(k,l){var m=c("degToRad")(k),n=c("degToRad")(90-l),o=Math.abs(k)>90?1:-1,p=Math.tan(m)*-o;if(!isFinite(p))return{x:1,y:0,z:0};var q=Math.sqrt(p*p+o*o)/Math.tan(n);if(!isFinite(q))return{x:0,y:1,z:0};return{x:p,y:q,z:o}},vec3ToYawPitch:function j(k,l,m){var n=Math.atan2(Math.sqrt(k*k+m*m),l),o=Math.atan2(k,-m);return{yaw:c("radToDeg")(o),pitch:90-c("radToDeg")(n)}},vec3ToPhotoXY:function j(k,l,m){__p&&__p();var n=Math.abs(Math.atan2(l,Math.sqrt(k*k+m*m)));if(l>0&&n<0)n*=-1;if(l<0&&n>0)n*=-1;n=(-n+Math.PI/2)/Math.PI;var o=-1*Math.atan2(k,m);if(o<0)o+=2*Math.PI;o/=2*Math.PI;return{x:o,y:n}},photoXYToVec3:function j(k,l){var m=(l-.5)*Math.PI,n=Math.sin(m),o=Math.cos(m),p=(k-.75)*2*Math.PI,q=Math.sin(p),r=Math.cos(p);k=r*o;l=-n;var s=q*o;return{x:k,y:l,z:s}},normalizeComposerXYToPhotoXY:function j(k){return k/100},normalizePhotoXYToComposerXY:function j(k){return k*100},coordinatesAreClose:function j(k,l){var m=arguments.length<=2||arguments[2]===undefined?.001:arguments[2],n=Math.abs(k.x-l.x),o=Math.abs(k.y-l.y);return!(n>m||o>m)},compareTags:function j(k,l){return!(k.center.pitch!==l.center.pitch||k.center.vec3[0]!==l.center.vec3[0]||k.center.vec3[1]!==l.center.vec3[1]||k.center.vec3[2]!==l.center.vec3[2]||k.center.yaw!==l.center.yaw||k.centerXY.x!==l.centerXY.x||k.centerXY.y!==l.centerXY.y||k.height_degree!==l.height_degree||k.width_degree!==l.width_degree)},getSpatialTagFromFBID:function j(k,l){for(var m=0;m<l.length;m++)if(l[m].fbid==k)return l[m];return null}};f.exports=i}),null);
__d("SphericalPhotoController.redux",["DOM","SphericalMediaController.react","SphericalMediaTaggingUtils","SphericalPhotoConfig","SphericalPhotoProjectionUtils","SphericalProjectionUtils","UserAgent","goURI","normalizeDeltaYaw","ReactRedux","SphericalMediaViewActions","SphericalMediaBaseActions","SphericalMediaConstants"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("ReactRedux").connect,k=c("SphericalProjectionUtils").convert3dTo2dScaledUnique,l=c("SphericalMediaViewActions").stopAnimating,m=c("SphericalMediaViewActions").updateViewportAndFOV,n=c("SphericalMediaViewActions").updateFOV,o=c("SphericalMediaBaseActions").dragStart,p=c("SphericalMediaBaseActions").gyroStart,q=c("SphericalMediaBaseActions").mouseEnter,r=c("SphericalMediaBaseActions").redirectFromClickedTag,s=c("SphericalMediaBaseActions").significantMove,t=c("SphericalMediaBaseActions").taggingStart,u=c("SphericalMediaBaseActions").taggingStop,v=c("SphericalMediaBaseActions").updateBase,w=c("SphericalMediaBaseActions").updateInitialViewport,x=c("SphericalMediaBaseActions").updateTagClicked,y=c("SphericalMediaBaseActions").updateTagUnderMouse,z=c("SphericalMediaBaseActions").viewportClicked,A=c("SphericalMediaBaseActions").updateCtrElem,B=c("SphericalMediaBaseActions").zoomStart,C=c("SphericalMediaConstants").UNTAGGED_FACEBOX;h=babelHelpers.inherits(D,c("SphericalMediaController.react"));i=h&&h.prototype;function D(F){__p&&__p();i.constructor.call(this,F);this.$SphericalPhotoController5=function(){this.onViewChange()}.bind(this);this.__onUpdateViewportBegin=function(){this.props.viewStore.dispatch(l())}.bind(this);this.__onUpdateViewportMoveStart=function(G){var H=this.props.dispatch;if(G)H(p());else H(o())}.bind(this);this.__onDOMClick=function(G){if(this.props.enableTagging){this.props.taggingMode?this.$SphericalPhotoController8(G):this.$SphericalPhotoController10(G);var H=this.$SphericalPhotoController7(G);this.props.dispatch(x(H))}this.props.dispatch(z())}.bind(this);this.__onViewportChange=function(G,H,I){if(this.props.enableTagging){var J=this.props,K=J.dispatch,L=J.isTagging,M=J.tagger;if(L&&M){M.hideTagger();K(u())}K(x(null))}this.props.viewStore.dispatch(m(G,H,I))}.bind(this);this.__onInitialViewportChange=function(G,H){this.props.dispatch(w(G,H))}.bind(this);this.__onZoomStart=function(){this.props.dispatch(B())}.bind(this);this.__onMouseEnter=function(){this.props.dispatch(q())}.bind(this);this.__onMouseMove=function(G){if(this.props.enableTagging){var H=this.$SphericalPhotoController7(G);if(H)if(H.type!==C)this.__changeCursorStyle("pointer");else this.__changeCursorStyle("crosshair");else this.__changeCursorStyle(this.$SphericalPhotoController6());this.props.dispatch(y(this.$SphericalPhotoController7(G)))}}.bind(this)}D.prototype.componentWillReceiveProps=function(F){i.componentWillReceiveProps.call(this,F);if(F.isTagging)this.__sphericalViewportControl&&this.__sphericalViewportControl.disableKeyboard();else this.__sphericalViewportControl&&this.__sphericalViewportControl.enableKeyboard();if(F.enableTagging&&this.props.taggingMode!==F.taggingMode)this.$SphericalPhotoController3(F);if(F.partialTopDegrees!==this.props.partialTopDegrees||F.partialBottomDegrees!==this.props.partialBottomDegrees||F.partialLeftDegrees!==this.props.partialLeftDegrees||F.partialRightDegrees!==this.props.partialRightDegrees)this.$SphericalPhotoController4(F)};D.prototype.shouldComponentUpdate=function(F){var G=i.shouldComponentUpdate.call(this,F)||this.props.tagger!==F.tagger&&this.props.enableTagging;return G};D.prototype.componentDidMount=function(){i.componentDidMount.call(this);this.props.viewStore.subscribe(this.$SphericalPhotoController5);this.props.dispatch(A(this.__viewport));this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};D.prototype.componentDidUpdate=function(){i.componentDidUpdate.call(this);this.props.dispatch(A(this.__viewport));this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};D.prototype.componentWillUnmount=function(){i.componentWillUnmount.call(this);this.props.dispatch(A(null))};D.prototype.$SphericalPhotoController3=function(F){__p&&__p();var G=F.tagger,H=this.__sphericalViewportControl;if(G&&H){if(this.$SphericalPhotoController1){H.removeLayer(this.$SphericalPhotoController1);this.$SphericalPhotoController1=null}if(this.$SphericalPhotoController2){H.removeLayer(this.$SphericalPhotoController2);this.$SphericalPhotoController2=null}try{var I=c("DOM").find(G.tagger,"div.faceBox");this.$SphericalPhotoController1=H.addNewLayer(I);if(F.taggingMode)this.$SphericalPhotoController2=H.addNewLayer(G.viewer.stageActions)}catch(J){}}};D.prototype.$SphericalPhotoController4=function(F){if(this.__sphericalViewportControl){this.__sphericalViewportControl.reconfigure(this.__getSphericalConfig(F));F.viewStore.dispatch(m(F.initialYaw,F.initialPitch,F.initialFov))}};D.prototype.$SphericalPhotoController6=function(){var F="grab";if(c("UserAgent").isEngine("WebKit"))F="-webkit-"+F;else if(c("UserAgent").isEngine("Gecko"))F="-moz-"+F;return F};D.prototype.$SphericalPhotoController7=function(F){var G=this.__getViewportMousePosition(F);if(!G)return null;var H=this.props,I=H.partialLeftDegrees,J=H.partialRightDegrees,K=H.partialTopDegrees,L=H.partialBottomDegrees,M=H.showNewPhotoRenderer,N=H.tags,O=this.props.viewStore.getState(),P=O.view,Q=null;if(N)N.forEach(function(R){if(M&&c("SphericalMediaTaggingUtils").isPointInTagAreaInNewPhotoRenderer(G,R,P,{w:this.props.width,h:this.props.height},{partialLeftDegrees:I,partialRightDegrees:J,partialTopDegrees:K,partialBottomDegrees:L})||c("SphericalMediaTaggingUtils").isPointInTagArea(G,R,P,{w:this.props.width,h:this.props.height}))Q=R}.bind(this));return Q};D.prototype.$SphericalPhotoController8=function(F){__p&&__p();if(!this.props.tagger)return;var G=this.$SphericalPhotoController7(F),H=this.__getViewData(),I=this.props,J=I.height,K=I.partialLeftDegrees,L=I.partialRightDegrees,M=I.partialTopDegrees,N=I.partialBottomDegrees,O=I.photoSphereMetadata,P=I.showNewPhotoRenderer,Q=I.width,R={partialLeftDegrees:K,partialRightDegrees:L,partialTopDegrees:M,partialBottomDegrees:N},S=void 0,T=void 0,U=void 0,V=void 0,W=void 0;if(G){if(G.type!==C){this.props.dispatch(r());G.url&&c("goURI")(G.url,true);return}if(G.type===C){var X=G.center,Y=X.yaw,Z=X.pitch;if(P){S=c("SphericalPhotoProjectionUtils").convert3dTo2d(Y,Z,H,Q,J,R);T=c("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(G,H,{w:Q,h:J},R)}else{S=k(Y,Z,H.yaw,H.pitch,H.fov,Q,J);T=c("SphericalMediaTaggingUtils").getSpatialTagArea(G,H,{w:Q,h:J})}V=G.centerXY;U=c("SphericalMediaTaggingUtils").pointsToRectSize(T);W=this.$SphericalPhotoController9(G)}else return}else{S=this.__getViewportMousePosition(F);U={w:100};if(!S)return;var $=void 0;if(P){$=c("SphericalPhotoProjectionUtils").convert2dTo3d(S.x,S.y,H,Q,J,R);if(!$)return}else $=c("SphericalProjectionUtils").convert2dTo3dScaled(S.x,S.y,H.yaw,H.pitch,H.fov,Q,J);V=c("SphericalMediaTaggingUtils").yawPitchToPhotoXY(c("normalizeDeltaYaw")($.yaw),$.pitch,O);W=null}if(V.y<0||V.y>1)return;this.props.tagger.addSpatialTag({screenPos:S,photoXY:V,suggestion:W,size:U.w,fromTag:!!G,inTaggingMode:this.props.taggingMode},F);this.props.dispatch(t())};D.prototype.$SphericalPhotoController10=function(F){__p&&__p();var G=this.$SphericalPhotoController7(F);if(G)if(G.type!==C){this.props.dispatch(r());G.url&&c("goURI")(G.url,true);return}else{if(!this.props.tagger)return;var H=this.props,I=H.height,J=H.partialLeftDegrees,K=H.partialRightDegrees,L=H.partialTopDegrees,M=H.partialBottomDegrees,N=H.showNewPhotoRenderer,O=H.width,P={partialLeftDegrees:J,partialRightDegrees:K,partialTopDegrees:L,partialBottomDegrees:M},Q=G.center,R=Q.yaw,S=Q.pitch,T=this.__getViewData(),U=void 0;if(N)U=c("SphericalPhotoProjectionUtils").convert3dTo2d(R,S,T,O,I,P);else U=k(R,S,T.yaw,T.pitch,T.fov,O,I);var V=G.centerXY,W=void 0;if(N)W=c("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(G,T,{w:O,h:I},P);else W=c("SphericalMediaTaggingUtils").getSpatialTagArea(G,T,{w:O,h:I});var X=c("SphericalMediaTaggingUtils").pointsToRectSize(W),Y=this.$SphericalPhotoController9(G);this.props.tagger.addSpatialTag({screenPos:U,photoXY:V,suggestion:Y,size:X.w,fromTag:true,inTaggingMode:this.props.taggingMode},F);this.props.dispatch(t())}else if(this.props.isTagging){this.props.tagger.hideTagger();this.props.dispatch(u())}};D.prototype.$SphericalPhotoController9=function(F){__p&&__p();if(!this.props.tagger||this.props.tagger.faceboxes.length<1)return null;var G=null,H=this.props.tagger.faceboxes;H.forEach(function(I){var J=I.rect,K=J.l,L=J.r,M=J.t,N=J.b,O={x:K+(L-K)/2,y:M+(N-M)/2};try{var P=JSON.parse(I.node.getAttribute("data-recognizeduids"));if(c("SphericalMediaTaggingUtils").coordinatesAreClose(O,F.centerXY)&&P.length>0)G=I}catch(Q){G=null}});return G};D.prototype.__onUpdateViewportEnd=function(){this.props.dispatch(v({isPanning:false}))};D.prototype.__onSignificantMove=function(F){this.props.dispatch(s(F))};D.prototype.__updateFOV=function(F){this.props.viewStore.dispatch(n(F))};D.prototype.__getViewData=function(){var F=this.props.viewStore.getState(),G=F.view;return{fov:G.fov,pitch:G.pitch,yaw:G.yaw}};D.__subClassMethods={__getViewData:true,__onUpdateViewportBegin:true,__onUpdateViewportMoveStart:true,__onDOMClick:true,__onUpdateViewportEnd:true,__onViewportChange:true,__onInitialViewportChange:true,__onZoomStart:true,__onMouseEnter:true,__onMouseMove:true,__onSignificantMove:true,__updateFOV:true};var E=function E(F){return{aspectRatio:F.base.aspectRatio,caption:F.base.caption,enableGyro:F.base.enableGyro,enableRubberBanding:F.base.enableRubberBanding,enableTagging:F.base.enableTagging,enableZoom:F.base.enableZoom,height:F.base.height,initialFov:F.base.initialFov,initialPitch:F.base.initialPitch,initialYaw:F.base.initialYaw,isActive:F.base.isRendererActive&&F.base.isRendererSetup||F.base.showFallbackUI,isTagging:F.base.isTagging,keyboardVelocityFactor:F.base.keyboardVelocityFactor,maxTileLevel:F.base.tiledSphericalConfig.maxTileLevel,panningVelocityFactor:F.base.panningVelocityFactor,partialBottomDegrees:F.base.partialBottomDegrees,partialLeftDegrees:F.base.partialLeftDegrees,partialRightDegrees:F.base.partialRightDegrees,partialTopDegrees:F.base.partialTopDegrees,photoSphereMetadata:F.base.photoSphereMetadata,tagger:F.base.tagger,taggingMode:F.base.taggingMode,tags:F.base.tags,showNewPhotoRenderer:F.base.tiledSphericalConfig.useTiledRenderer&&c("SphericalPhotoConfig").show_new_renderer,viewStore:F.base.viewStore,width:F.base.width}};f.exports=j(E)(D)}),null);
__d("SphericalPhotoFallbackMiddleware",["SphericalMediaBaseActions","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalMediaBaseActions").useFallbackUI,i=c("SphericalMediaBaseActions").disableTagging,j=function j(k){var l=k.dispatch,m=k.getState;return function(n){return function(o){if(o.type===c("SphericalMediaActions").WEBGL_INIT_FAILED){l(i());l(h())}return n(o)}}};f.exports=j}),null);
__d("CubemapImageTile",[],(function a(b,c,d,e,f,g){"use strict";function h(i,j){this.$CubemapImageTile1=i;this.$CubemapImageTile2=j}h.prototype.getInfo=function(){return this.$CubemapImageTile1};h.prototype.getImg=function(){return this.$CubemapImageTile2};f.exports=h}),null);
__d("CubemapImageTileInfo",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j,k,l){this.level=i;this.face=j;this.col=k;this.row=l}h.prototype.getKey=function(){return""+this.level+"_"+this.face+"_"+this.col+"_"+this.row};h.prototype.getInfoForOffsetLevel=function(i){var j=this.level-i;if(j<0)throw new Error("Invalid level offset for getKeyForOffsetLevel: "+i+", max offset: "+this.level);var k=Math.floor(this.col/Math.pow(2,i)),l=Math.floor(this.row/Math.pow(2,i));return new h(j,this.face,k,l)};f.exports=h}),null);
__d("CubemapImageTileProvider",["CubemapImageTile","CubemapImageTileInfo","Map","SphericalMediaConstants","performanceNow"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalMediaConstants").TILED_CUBE_FACES,i=c("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE,j=c("SphericalMediaConstants").TILED_CUBE_TILE_PADDING_PIXELS;function k(l,m,n){__p&&__p();this.$CubemapImageTileProvider14=function(o,p,q){var r=new Image(),s=new(c("CubemapImageTile"))(o,r);r.crossOrigin="anonymous";r.onload=function(){return this.$CubemapImageTileProvider15(s,q)}.bind(this);r.src=p}.bind(this);this.$CubemapImageTileProvider1=l;this.$CubemapImageTileProvider9=0;this.$CubemapImageTileProvider10={};this.$CubemapImageTileProvider2=false;this.$CubemapImageTileProvider3=[];this.$CubemapImageTileProvider4=[];this.$CubemapImageTileProvider5=new(c("Map"))();this.$CubemapImageTileProvider6=false;this.$CubemapImageTileProvider7=[];this.$CubemapImageTileProvider8=new(c("Map"))();this.$CubemapImageTileProvider11=m;this.$CubemapImageTileProvider12();if(n&&n.length)this.$CubemapImageTileProvider13(n);else this.$CubemapImageTileProvider6=true}k.prototype.getTileContentSize=function(){return i};k.prototype.getTilePaddingPixels=function(){return j};k.prototype.getTileTotalSize=function(){return 2*j+i};k.prototype.getMaxTileLevel=function(){return this.$CubemapImageTileProvider11};k.prototype.getTotalPixelsLoaded=function(){return this.$CubemapImageTileProvider9*Math.pow(this.getTileTotalSize(),2)};k.prototype.getBaseLevelImageTiles=function(){return this.$CubemapImageTileProvider5};k.prototype.getViewportImageTiles=function(){return this.$CubemapImageTileProvider8};k.prototype.addBaseLevelReadyCallback=function(l){if(!this.$CubemapImageTileProvider2)this.$CubemapImageTileProvider3.push(l);else l()};k.prototype.isBaseLevelReady=function(){return this.$CubemapImageTileProvider2};k.prototype.isViewportReady=function(){return this.$CubemapImageTileProvider6};k.prototype.loadTileImage=function(l,m,n){var o=l.getKey();if(o in this.$CubemapImageTileProvider10)m(this.$CubemapImageTileProvider10[o],n);else this.$CubemapImageTileProvider1.getUriForTile(l,function(l,p){this.$CubemapImageTileProvider14(l,p,m)}.bind(this))};k.prototype.$CubemapImageTileProvider12=function(){this.$CubemapImageTileProvider4=[new(c("CubemapImageTileInfo"))(0,h.PLUS_X,0,0),new(c("CubemapImageTileInfo"))(0,h.MINUS_X,0,0),new(c("CubemapImageTileInfo"))(0,h.PLUS_Y,0,0),new(c("CubemapImageTileInfo"))(0,h.MINUS_Y,0,0),new(c("CubemapImageTileInfo"))(0,h.PLUS_Z,0,0),new(c("CubemapImageTileInfo"))(0,h.MINUS_Z,0,0)];this.$CubemapImageTileProvider4.forEach(function(l){return this.$CubemapImageTileProvider1.getUriForTile(l,this.$CubemapImageTileProvider14)}.bind(this))};k.prototype.$CubemapImageTileProvider13=function(l){l.forEach(function(m){var n=new(c("CubemapImageTileInfo"))(m.level,m.face,m.col,m.row);this.$CubemapImageTileProvider7.push(n);this.$CubemapImageTileProvider14(n,m.uri)}.bind(this))};k.prototype.$CubemapImageTileProvider15=function(l,m){__p&&__p();var n=l.getInfo().getKey();this.$CubemapImageTileProvider10[n]=l;this.$CubemapImageTileProvider9++;if(!this.$CubemapImageTileProvider2){var o=this.$CubemapImageTileProvider4.every(function(q){return q.getKey()in this.$CubemapImageTileProvider10}.bind(this)),p=this.$CubemapImageTileProvider7.length?this.$CubemapImageTileProvider7.every(function(q){return q.getKey()in this.$CubemapImageTileProvider10}.bind(this)):true;if(l.getInfo().level===0)this.$CubemapImageTileProvider5.set(l.getInfo().getKey(),l);else this.$CubemapImageTileProvider8.set(l.getInfo().getKey(),l);if(o&&p)this.$CubemapImageTileProvider16()}else m&&m(l,c("performanceNow")())};k.prototype.$CubemapImageTileProvider16=function(){this.$CubemapImageTileProvider2=true;this.$CubemapImageTileProvider6=true;this.$CubemapImageTileProvider3.forEach(function(l){return l()})};f.exports=k}),null);
__d("BaseCubemapTileUriProvider",["invariant","CubemapImageTileInfo"],(function a(b,c,d,e,f,g,h){"use strict";i.prototype.getUriForTile=function(j,k){h(0)};function i(){}f.exports=i}),null);
__d("XSphericalPhotoTileURIsAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/spherical_media/photo/tile/",{})}),null);
__d("EntPhotoCubemapTileUriProvider",["Promise","BaseCubemapTileUriProvider","CubemapImageTileInfo","Map","XAsyncRequest","XSphericalPhotoTileURIsAsyncController","flattenPHPQueryData","throttle"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=200;h=babelHelpers.inherits(k,c("BaseCubemapTileUriProvider"));i=h&&h.prototype;function k(l,m){__p&&__p();i.constructor.call(this);this.$EntPhotoCubemapTileUriProvider9=c("throttle")(function(){this.$EntPhotoCubemapTileUriProvider10(this.$EntPhotoCubemapTileUriProvider3);this.$EntPhotoCubemapTileUriProvider3=new(c("Map"))()}.bind(this),j);this.$EntPhotoCubemapTileUriProvider1=l;this.$EntPhotoCubemapTileUriProvider2=new(c("Map"))();this.$EntPhotoCubemapTileUriProvider3=new(c("Map"))();this.$EntPhotoCubemapTileUriProvider4=new(c("Map"))();this.$EntPhotoCubemapTileUriProvider5=new(c("Map"))();this.$EntPhotoCubemapTileUriProvider7(m);this.$EntPhotoCubemapTileUriProvider6=0}k.prototype.getUriForTile=function(l,m){var n=l.getKey(),o=this.$EntPhotoCubemapTileUriProvider2.get(n);if(!o){if(this.$EntPhotoCubemapTileUriProvider5.has(n))return;this.$EntPhotoCubemapTileUriProvider8({tileInfo:l,onURIfetched:m})}else m(l,o)};k.prototype.$EntPhotoCubemapTileUriProvider8=function(l){var m=l.tileInfo.getKey(),n=this.$EntPhotoCubemapTileUriProvider3.get(m),o=this.$EntPhotoCubemapTileUriProvider4.get(m);if(!n&&!o){this.$EntPhotoCubemapTileUriProvider3.set(m,l);this.$EntPhotoCubemapTileUriProvider9()}};k.prototype.$EntPhotoCubemapTileUriProvider10=function(l){__p&&__p();if(l.size===0)return new(c("Promise"))(function(){});var m=[];l.forEach(function(o){var p=o.tileInfo;this.$EntPhotoCubemapTileUriProvider4.set(p.getKey(),p);m.push({level:p.level,face:p.face,col:p.col,row:p.row})}.bind(this));var n={photo_id:this.$EntPhotoCubemapTileUriProvider1,tile_info_list:m};return this.$EntPhotoCubemapTileUriProvider11(c("XSphericalPhotoTileURIsAsyncController").getURIBuilder().getURI(),n).then(function(o){this.$EntPhotoCubemapTileUriProvider7(o.payload);l.forEach(function(p){var q=p.tileInfo,r=p.onURIfetched,s=q.getKey(),t=this.$EntPhotoCubemapTileUriProvider2.get(s);if(t)r(q,t);else this.$EntPhotoCubemapTileUriProvider5.set(s,true);this.$EntPhotoCubemapTileUriProvider4["delete"](s)}.bind(this))}.bind(this),function(o){}.bind(this))};k.prototype.$EntPhotoCubemapTileUriProvider11=function(l,m){return new(c("Promise"))(function(n,o){return new(c("XAsyncRequest"))(l).setMethod("POST").setData(c("flattenPHPQueryData")(m)).setHandler(n).setErrorHandler(o).send()})};k.prototype.$EntPhotoCubemapTileUriProvider7=function(l){l.forEach(function(m){var n=new(c("CubemapImageTileInfo"))(m.level,m.face,m.col,m.row);this.$EntPhotoCubemapTileUriProvider2.set(n.getKey(),m.uri)}.bind(this))};f.exports=k}),null);
__d("StaticCubemapTileUriProvider",["BaseCubemapTileUriProvider","CubemapImageTileInfo","Map"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("BaseCubemapTileUriProvider"));i=h&&h.prototype;function j(k){i.constructor.call(this);this.$StaticCubemapTileUriProvider1=new(c("Map"))();k.forEach(function(l){var m=new(c("CubemapImageTileInfo"))(l.level,l.face,l.col,l.row);this.$StaticCubemapTileUriProvider1.set(m.getKey(),l.uri)}.bind(this))}j.prototype.getUriForTile=function(k,l){var m=k.getKey(),n=this.$StaticCubemapTileUriProvider1.get(m);n&&l(k,n)};f.exports=j}),null);
__d("BaseRotatableWebGLRenderer",["EventEmitter","EventListener","GLMatrix","Map","getErrorNameFromWebGLErrorCode","performanceNow","radToDeg"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("GLMatrix").glMatrix,k=c("GLMatrix").mat4,l=Math.max(window.devicePixelRatio||1,1),m=179;h=babelHelpers.inherits(n,c("EventEmitter"));i=h&&h.prototype;function n(o){__p&&__p();i.constructor.call(this);this.__handleContextLost=function(q){q.preventDefault();this.emit("renderingContextLost");this.__contextLost=true}.bind(this);this.__handleContextRestore=function(q){this.__setup();this.emit("renderingContextRestore")}.bind(this);if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var p in this.constructor.__subClassMethods)if(typeof this[p]!=="function")throw new Error('Must implement "'+p+'"');this.__firstRenderTime=-1;this.__previousRenderFinishTime=-1;this.__sumOfRenderTimes=0;this.__framesRenderedCount=0;this.__sumTextureScreenRatioValues=0;this.__textureScreenRatioMillisCounted=0;this.__canvas=o;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__shaders=[];this.__contextLost=false;this.__horizontalFieldOfView=0;this.__verticalFieldOfView=0;this.__perspectiveMatrix=k.create();this.__rotationMatrix=k.create();this.__shouldEnableBlend=false;this.__useVfovAsIs=false;this.__canvas.addEventListener("webglcontextlost",this.__handleContextLost);this.__canvas.addEventListener("webglcontextrestored",this.__handleContextRestore)}n.prototype.destroy=function(){this.__canvas.removeEventListener("webglcontextlost",this.__handleContextLost);this.__canvas.removeEventListener("webglcontextrestored",this.__handleContextRestore);this.__shaders.forEach(function(o){try{this.__gl.detachShader(this.__shaderProgram,o)}catch(p){}}.bind(this));this.__shaders=[];this.__clearCache();this.__destroyed=true};n.prototype.updateFieldOfView=function(o){var p=Math.min(o,m/this.__aspectRatio);if(this.__useVfovAsIs)p=o;var q=Math.min(m,p);this.__verticalFieldOfView=q;this.__updateHorizontalFieldOfView();this.__updatePerspective()};n.prototype.updateViewportDimensions=function(o,p){this.__canvas.width=o*l;this.__canvas.height=p*l;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__updateHorizontalFieldOfView();this.__updatePerspective()};n.prototype.hasRenderingContext=function(){return!this.__contextLost};n.prototype.getScreenshotDataURL=function(o,p,q){if(!this.__gl||this.__contextLost)return"";this.render(o);return this.__canvas.toDataURL(p,q)};n.prototype.getAverageFrameRenderTimeMillis=function(){if(this.__framesRenderedCount===0)return 0;return this.__sumOfRenderTimes/this.__framesRenderedCount};n.prototype.getMaxGPUMemoryUsedBytes=function(){return this.__getMaxGPUMemoryUsedBytes()};n.prototype.getAverageTextureToScreenPixelRatio=function(){if(this.__textureScreenRatioMillisCounted===0)return 0;return this.__sumTextureScreenRatioValues/this.__textureScreenRatioMillisCounted};n.prototype.getTimeSinceFirstRenderMillis=function(){return c("performanceNow")()-this.__firstRenderTime};n.prototype.renderErrorCheck=function(){this.__createTexture()};n.prototype.render=function(o){__p&&__p();if(this.__contextLost||this.__destroyed)return;this.__view=o;if(!this.__isValidView(o)){this.emit("renderingError",new Error("invalid view"),o);return}var p=c("performanceNow")();if(this.__firstRenderTime===-1)this.__firstRenderTime=p;if(o.fov!==this.__verticalFieldOfView)this.updateFieldOfView(o.fov);k.identity(this.__rotationMatrix);k.rotateX(this.__rotationMatrix,this.__rotationMatrix,-j.toRadian(o.pitch));k.rotateY(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(o.yaw));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);var q=this.__getPrevFrameTextureScreenRatio();this.__renderInternal();var r=c("performanceNow")();this.__sumOfRenderTimes+=r-p;this.__framesRenderedCount+=1;if(this.__previousRenderFinishTime>0){var s=2e3,t=Math.min(r-this.__previousRenderFinishTime,s);this.__sumTextureScreenRatioValues+=t*q;this.__textureScreenRatioMillisCounted+=t}this.__previousRenderFinishTime=r};n.prototype.renderWithRotationMatrixForMSite=function(o){k.rotateX(o,o,j.toRadian(90));this.renderWithRotationMatrix(o)};n.prototype.renderWithRotationMatrix=function(o){if(this.__contextLost)return;this.__rotationMatrix=o;this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);this.__renderInternal()};n.prototype.__isValidView=function(o){return!Number.isNaN(o.fov+o.pitch+o.yaw)};n.prototype.__copyTextureToGLBuffer=function(o,p){var q=arguments.length<=2||arguments[2]===undefined?false:arguments[2],r=this.__getNewGLTexObj(p);this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,q);this.__gl.bindTexture(this.__gl.TEXTURE_2D,r);this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,o.image);var s=this.__gl.getError();if(s!==0)this.__emitRenderingError(s);return r};n.prototype.__setup=function(){__p&&__p();if(!this.__gl||!this.__contextLost){this.__gl=this.__getGL();this.__contextLost=false}this.__gl.clearColor(0,0,0,1);if(this.__shouldEnableBlend){this.__gl.enable(this.__gl.BLEND);this.__gl.blendFunc(this.__gl.SRC_ALPHA,this.__gl.ONE_MINUS_SRC_ALPHA)}this.updateViewportDimensions(this.__canvas.clientWidth,this.__canvas.clientHeight);var o=this.__initShaders();if(!o.success){var p=c("getErrorNameFromWebGLErrorCode")(this.__gl.getError());throw new Error("\n        Failed to intialize shaders: "+p+"\n        Error Message: "+o.error+"\n      ")}};n.prototype.__getGL=function(){__p&&__p();if(this.__gl&&!this.__contextLost)return this.__gl;if(!b.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");var o=["webgl","experimental-webgl","webkit-3d","moz-webgl"],p=null,q=null,r=c("EventListener").listen(this.__canvas,"webglcontextcreationerror",function(t){return q=t.statusMessage});for(var s=0;s<o.length;s++){try{p=this.__canvas.getContext(o[s])}catch(t){}if(p)break}r.remove();if(!p){q=q||"Unknown error.";throw new Error("Failed to acquire 3D rendering context: "+q)}return p};n.prototype.__updatePerspective=function(){k.perspective(this.__perspectiveMatrix,j.toRadian(this.__verticalFieldOfView),this.__aspectRatio,.1,100);this.__gl.viewport(0,0,this.__gl.drawingBufferWidth,this.__gl.drawingBufferHeight)};n.prototype.__initShaders=function(){__p&&__p();this.__shaderProgram=this.__gl.createProgram();try{this.__attachShaders(this.__shaderProgram)}catch(o){return{success:false,error:"Shader: "+o.message}}this.__gl.linkProgram(this.__shaderProgram);var p=this.__gl.getProgramParameter(this.__shaderProgram,this.__gl.LINK_STATUS);if(!p)return{success:false,error:"No link. Could not initialize shaders"};this.__gl.useProgram(this.__shaderProgram);this.__setShaderMatrixPointers();this.__shaderProgramReady();return{success:true,error:""}};n.prototype.__setShaderMatrixPointers=function(){this.__shaderPMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderPerspectiveMatrixUniformName());this.__shaderRotMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderRotationMatrixUniformName())};n.prototype.__getShaderConfigs=function(){var o=new(c("Map"))();o.set(this.__gl.VERTEX_SHADER,this.__getVertexShaderScript());o.set(this.__gl.FRAGMENT_SHADER,this.__getFragmentShaderScript());return o};n.prototype.__attachShaders=function(o){var p=this.__getShaderConfigs();p.forEach(function(q,r){var s=this.__gl.createShader(r);this.__gl.shaderSource(s,q);this.__gl.compileShader(s);if(!this.__gl.getShaderParameter(s,this.__gl.COMPILE_STATUS))throw new Error(this.__gl.getShaderInfoLog(s));this.__gl.attachShader(o,s);this.__shaders.push(s)}.bind(this))};n.prototype.__getNewGLTexObj=function(o){var p=this.__gl.createTexture();this.__gl.bindTexture(o,p);this.__gl.texParameteri(o,this.__gl.TEXTURE_MAG_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_MIN_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_S,this.__gl.CLAMP_TO_EDGE);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_T,this.__gl.CLAMP_TO_EDGE);this.__gl.bindTexture(o,null);return p};n.prototype.__updateHorizontalFieldOfView=function(){var o=j.toRadian(this.__verticalFieldOfView),p=2*Math.atan(Math.tan(o/2)*this.__aspectRatio);this.__horizontalFieldOfView=c("radToDeg")(p)};n.prototype.__emitRenderingError=function(o){this.emit("renderingError",new Error("WebGL Error Code: "+o))};f.exports=n}),null);
__d("TileRendererState",["CubemapImageTileInfo"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=1e3,i=1e3;function j(k,l){this.tileInfo=k;this.blendingProgress=0;this.closestCoveringTile=l;this.closestPrevTile=l;this.durationInViewMS=0;this.isInView=true}j.prototype.enterView=function(k){this.blendingProgress=1;this.closestCoveringTile=k;this.closestPrevTile=k;this.durationInViewMS=0;this.isInView=true};j.prototype.exitView=function(){this.closestCoveringTile=null;this.closestPrevTile=null;this.isInView=false};j.prototype.shouldFetch=function(k){return this.durationInViewMS<h&&this.durationInViewMS+k>=h};j.prototype.update=function(k,l){this.updateBlendingProgress(k,l);this.durationInViewMS+=k};j.prototype.updateBlendingProgress=function(k,l){if(!l||!this.closestCoveringTile)return;var m=l.level-this.closestCoveringTile.level;if(m>0){this.closestCoveringTile=l;this.blendingProgress=this.blendingProgress>=1?0:this.blendingProgress/(1*Math.pow(2,m))}if(this.blendingProgress<1)this.blendingProgress=Math.min(this.blendingProgress+1*k/i,1)};f.exports=j}),null);
__d("TiledSphericalRendererTextureCache",["Map","TileRendererState","performanceNow"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j,k,l,m,n,o){this.TEXTURE_CACHE_LIMIT=i;this.$TiledSphericalRendererTextureCache3=j;this.$TiledSphericalRendererTextureCache5=l;this.$TiledSphericalRendererTextureCache4=k;this.$TiledSphericalRendererTextureCache7=m;this.$TiledSphericalRendererTextureCache8=n;this.$TiledSphericalRendererTextureCache6=o;this.$TiledSphericalRendererTextureCache1=new(c("Map"))();this.$TiledSphericalRendererTextureCache2=new(c("Map"))()}h.prototype.createTexture=function(){if(this.$TiledSphericalRendererTextureCache2.size===0&&this.$TiledSphericalRendererTextureCache3.isBaseLevelReady())this.$TiledSphericalRendererTextureCache9();if(this.$TiledSphericalRendererTextureCache1.size===0&&this.$TiledSphericalRendererTextureCache3.isViewportReady())this.$TiledSphericalRendererTextureCache10()};h.prototype.clearCache=function(){this.$TiledSphericalRendererTextureCache2.forEach(function(i){this.$TiledSphericalRendererTextureCache5.deleteTexture(i)}.bind(this));this.$TiledSphericalRendererTextureCache2.clear();this.$TiledSphericalRendererTextureCache1.forEach(function(i){this.$TiledSphericalRendererTextureCache5.deleteTexture(i.texture)}.bind(this));this.$TiledSphericalRendererTextureCache1.clear()};h.prototype.cacheTexture=function(i){__p&&__p();var j,k=this,l=i.getInfo().getKey(),m=this.$TiledSphericalRendererTextureCache1.get(l);if(!m){var n=this.$TiledSphericalRendererTextureCache8({image:i.getImg()},this.$TiledSphericalRendererTextureCache5.TEXTURE_2D),o=this.$TiledSphericalRendererTextureCache5.getError();if(o!==0)this.$TiledSphericalRendererTextureCache6("renderingError","WebGL Error Code: "+o);m={texture:n,lastUsedTime:c("performanceNow")()};this.$TiledSphericalRendererTextureCache1.set(l,m);if(this.$TiledSphericalRendererTextureCache1.size>this.TEXTURE_CACHE_LIMIT)(function(){var p=l,q=m;k.$TiledSphericalRendererTextureCache1.forEach(function(r,s){if(r.lastUsedTime<q.lastUsedTime){p=s;q=r}});k.$TiledSphericalRendererTextureCache5.deleteTexture(q.texture);k.$TiledSphericalRendererTextureCache1["delete"](p);k.$TiledSphericalRendererTextureCache4["delete"](p)})()}};h.prototype.getTextureCache=function(){return this.$TiledSphericalRendererTextureCache1};h.prototype.getBaseLevelTexCache=function(){return this.$TiledSphericalRendererTextureCache2};h.prototype.$TiledSphericalRendererTextureCache9=function(){var i=this.$TiledSphericalRendererTextureCache3.getBaseLevelImageTiles();i.forEach(function(j){var k=this.$TiledSphericalRendererTextureCache8({image:j.getImg()},this.$TiledSphericalRendererTextureCache5.TEXTURE_2D),l=this.$TiledSphericalRendererTextureCache5.getError();if(l!==0)this.$TiledSphericalRendererTextureCache7(l);this.$TiledSphericalRendererTextureCache2.set(j.getInfo().getKey(),k)}.bind(this))};h.prototype.$TiledSphericalRendererTextureCache10=function(){var i=this.$TiledSphericalRendererTextureCache3.getViewportImageTiles();i.forEach(function(j){var k=this.$TiledSphericalRendererTextureCache8({image:j.getImg()},this.$TiledSphericalRendererTextureCache5.TEXTURE_2D),l=this.$TiledSphericalRendererTextureCache5.getError();if(l!==0)this.$TiledSphericalRendererTextureCache7(l);var m={texture:k,lastUsedTime:c("performanceNow")()};this.$TiledSphericalRendererTextureCache1.set(j.getInfo().getKey(),m)}.bind(this))};f.exports=h}),null);
__d("TiledSphericalRendererStats",["TiledSphericalRendererTextureCache"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j,k,l){this.$TiledSphericalRendererStats1=i;this.$TiledSphericalRendererStats2=j;this.$TiledSphericalRendererStats3=k;this.$TiledSphericalRendererStats4=l}h.prototype.getMaxGPUMemoryUsedBytes=function(){var i=this.$TiledSphericalRendererStats3.getTileTotalSize(),j=4,k=this.$TiledSphericalRendererStats2.getTextureCache().size+this.$TiledSphericalRendererStats2.getBaseLevelTexCache().size;return i*i*j*k};h.prototype.getTileToCanvasPixelRatio=function(i,j){var k=this.$TiledSphericalRendererStats4.height/j,l=90/Math.pow(2,i),m=this.$TiledSphericalRendererStats3.getTileContentSize()/l;return m/k};f.exports=h}),null);
__d("TiledSphericalRendererUtils",["CubemapImageTileInfo","GLMatrix","Map","SphericalMediaConstants"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("GLMatrix").glMatrix,i=c("GLMatrix").mat4,j=c("GLMatrix").vec3,k=c("SphericalMediaConstants").TILED_CUBE_FACES,l={fetchImage:function m(n,o,p,q,r,s){var t=n;while(!o.has(t.getKey())&&!p.has(t.getKey())){q.loadTileImage(t,r,s);t=t.getInfoForOffsetLevel(1)}},getLinePlaneIntersection:function m(n,o,p,q){var r=-o/(q-o),s=j.create();j.subtract(s,p,n);j.scale(s,s,r);j.add(s,s,n);return s},clipPolygon3D:function m(n,o){__p&&__p();var p=o[o.length-1];for(var q=0;q<o.length;q++){var r=o[q],s=[],t=j.create();j.cross(t,p,r);var u=n[n.length-1],v=j.dot(t,u),w=v>=0;for(var x=0;x<n.length;x++){var y=n[x],z=j.dot(t,y),A=z>=0;if(A!==w){var B=this.getLinePlaneIntersection(u,v,y,z);if(!j.exactEquals(u,B)&&!j.exactEquals(y,B))s.push(B)}if(A)s.push(y);u=y;v=z;w=A}n=s;if(n.length===0)break;p=r}return n},initFaceRotationMatrices:function m(n){__p&&__p();var o=[],p=[],q=[],r=i.create();i.identity(r);i.rotateY(r,r,h.toRadian(-90));o[k.PLUS_X]=r;p[k.MINUS_X]=r;var s=i.create();i.identity(s);i.rotateY(s,s,h.toRadian(90));o[k.MINUS_X]=s;p[k.PLUS_X]=s;var t=i.create();i.identity(t);i.rotateZ(t,t,h.toRadian(180));i.rotateX(t,t,h.toRadian(-90));o[k.PLUS_Y]=t;var u=i.create();i.identity(u);i.rotateX(u,u,h.toRadian(90));p[k.PLUS_Y]=u;var v=i.create();i.identity(v);i.rotateZ(v,v,h.toRadian(180));i.rotateX(v,v,h.toRadian(90));o[k.MINUS_Y]=v;var w=i.create();i.identity(w);i.rotateX(w,w,h.toRadian(-90));p[k.MINUS_Y]=w;var x=i.create();i.identity(x);i.rotateY(x,x,h.toRadian(180));o[k.PLUS_Z]=x;p[k.MINUS_Z]=x;var y=i.create();i.identity(y);o[k.MINUS_Z]=y;p[k.PLUS_Z]=y;var z=[j.fromValues(-n,n,-n),j.fromValues(n,n,-n),j.fromValues(n,-n,-n),j.fromValues(-n,-n,-n)];for(var A=0;A<6;A++){var B=o[A],C=[];for(var D=0;D<z.length;D++){var E=j.create();j.transformMat4(E,z[D],B);C.push(E)}q[A]=C}return{faceRotationMatrices:o,faceTransformMatrices:p,faceVertexLists:q}},rotateVec3s:function m(n,o){for(var p=0;p<o.length;p++)j.transformMat4(o[p],o[p],n)}};f.exports=l}),null);
__d("TiledSphericalRenderer",["BaseRotatableWebGLRenderer","CubemapImageTileInfo","GLMatrix","Map","TiledSphericalRendererStats","TiledSphericalRendererTextureCache","TiledSphericalRendererUtils","TileRendererState","debounceCore","performanceNow","throttle"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("GLMatrix").glMatrix,k=c("GLMatrix").mat4,l=c("GLMatrix").vec3,m=44;h=babelHelpers.inherits(n,c("BaseRotatableWebGLRenderer"));i=h&&h.prototype;function n(o,p,q,r){__p&&__p();i.constructor.call(this,o);this.$TiledSphericalRenderer37=function(s,t){var u=s.getInfo().getKey();this.$TiledSphericalRenderer5.set(u,s);if(t!==this.$TiledSphericalRenderer8){this.$TiledSphericalRenderer8=this.$TiledSphericalRenderer6;setTimeout(this.$TiledSphericalRenderer38,0)}}.bind(this);this.$TiledSphericalRenderer39=c("debounceCore")(function(){return this.__renderInternal()}.bind(this),30);this.$TiledSphericalRenderer33=c("throttle")(function(){return this.__renderInternal()}.bind(this),100);this.$TiledSphericalRenderer41=c("debounceCore")(function(){var s=this.$TiledSphericalRenderer5;this.$TiledSphericalRenderer5=new(c("Map"))();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer10.forEach(function(t){return setTimeout(function(){return this.$TiledSphericalRenderer40(t,s)}.bind(this),0)}.bind(this))}.bind(this),100);this.$TiledSphericalRenderer38=c("throttle")(function(){var s=this.$TiledSphericalRenderer5;this.$TiledSphericalRenderer5=new(c("Map"))();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer10.forEach(function(t){return setTimeout(function(){return this.$TiledSphericalRenderer40(t,s)}.bind(this),0)}.bind(this))}.bind(this),100);this.$TiledSphericalRenderer1=p;this.$TiledSphericalRenderer2=q;this.$TiledSphericalRenderer3=1;this.$TiledSphericalRenderer4=0;this.$TiledSphericalRenderer6=-1;this.$TiledSphericalRenderer7=-1;this.$TiledSphericalRenderer8=0;this.$TiledSphericalRenderer5=new(c("Map"))();this.$TiledSphericalRenderer9=[];this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer11=new(c("Map"))();this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer13=new(c("Map"))();this.$TiledSphericalRenderer14=0;this.$TiledSphericalRenderer26();this.__setup();this.$TiledSphericalRenderer16=new(c("TiledSphericalRendererTextureCache"))(m,this.$TiledSphericalRenderer1,this.$TiledSphericalRenderer13,this.__gl,this.__emitRenderingError.bind(this),this.__copyTextureToGLBuffer.bind(this),this.emit.bind(this));this.$TiledSphericalRenderer15=new(c("TiledSphericalRendererStats"))(q,this.$TiledSphericalRenderer16,this.$TiledSphericalRenderer1,this.__canvas)}n.prototype.__clearCache=function(){this.$TiledSphericalRenderer27();this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer16.clearCache();this.$TiledSphericalRenderer13.clear()};n.prototype.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};n.prototype.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};n.prototype.__shaderProgramReady=function(){__p&&__p();this.$TiledSphericalRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer19);this.$TiledSphericalRenderer20=this.__gl.getAttribLocation(this.__shaderProgram,"aTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer20);this.$TiledSphericalRenderer21=this.__gl.getAttribLocation(this.__shaderProgram,"aBGTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer21);var o=this.__gl.getUniformLocation(this.__shaderProgram,"uContentSampler"),p=this.__gl.getUniformLocation(this.__shaderProgram,"uBackgroundSampler"),q=0;this.$TiledSphericalRenderer23=this.__gl.TEXTURE0;var r=1;this.$TiledSphericalRenderer24=this.__gl.TEXTURE1;this.__gl.uniform1i(o,q);this.__gl.uniform1i(p,r);this.$TiledSphericalRenderer22=this.__gl.getAttribLocation(this.__shaderProgram,"aPrevLevelTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer22);var s=this.__gl.getUniformLocation(this.__shaderProgram,"uPrevLevelSampler"),t=2;this.$TiledSphericalRenderer25=this.__gl.TEXTURE2;this.__gl.uniform1i(s,t);this.$TiledSphericalRenderer28()};n.prototype.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n      attribute vec2 aTextureCoord;\n      attribute vec2 aBGTextureCoord;\n      attribute vec2 aPrevLevelTextureCoord;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vTextureCoord = aTextureCoord;\n        vBGTextureCoord = aBGTextureCoord;\n        vPrevLevelTextureCoord = aPrevLevelTextureCoord;\n      }\n    "};n.prototype.__getFragmentShaderScript=function(){return"\n      #define PI 3.1415926538\n\n      precision highp float;\n      // 1 degree blend zone\n      const highp float blendDist = PI / 180.0;\n\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      varying highp vec3 vCurrentRay;\n      uniform highp vec2 uHorizontalAngleBounds;\n      uniform highp vec2 uVerticleAngleBounds;\n\n      uniform sampler2D uContentSampler;\n      uniform sampler2D uBackgroundSampler;\n      uniform sampler2D uPrevLevelSampler;\n\n      uniform float progress;\n\n      void main(void) {\n        highp float x = vCurrentRay[0];\n        highp float y = vCurrentRay[1];\n        highp float z = vCurrentRay[2];\n        highp float hAngle = atan(x, -1.0 * z);\n        highp float vAngle = atan(y * inversesqrt(x*x + z*z));\n\n        // if current ray is inside the content bounds, use the content sampler\n        // to set the fragment color. if it is not within the bounds, use the\n        // background sampler to set the color.*\n\n        highp float hdist = 0.0;\n        highp float vdist = 0.0;\n        if (hAngle < uHorizontalAngleBounds[0]) {\n          hdist = uHorizontalAngleBounds[0] - hAngle;\n        } else if (hAngle > uHorizontalAngleBounds[1]) {\n          hdist = hAngle - uHorizontalAngleBounds[1];\n        }\n        if (vAngle < uVerticleAngleBounds[0]) {\n          vdist = uVerticleAngleBounds[0] - vAngle;\n        } else if (vAngle > uVerticleAngleBounds[1]) {\n          vdist = vAngle - uVerticleAngleBounds[1];\n        }\n        highp float maxDist = max(hdist, vdist);\n        highp vec4 bgColor = texture2D(\n          uBackgroundSampler,\n          vec2(vBGTextureCoord.s, vBGTextureCoord.t)\n        );\n        highp vec4 contentColor = texture2D(\n          uContentSampler,\n          vec2(vTextureCoord.s, vTextureCoord.t)\n        );\n        if (maxDist > 0.0) {\n          // Inside this condition, our fragment is outside the content bounds.\n          // The distance outside the bound is represented by maxDist. It could\n          // be the horizontal or vertical distance from a bound, whichever is\n          // larger. We will use this distance to blend the content with the\n          // background, if the distance is smaller than blendDist. If it is\n          // larger than blendDist, we will use purely the background tex to\n          // set the color. If dist is within the blendDist, then we will set\n          // the color to the linearly weighted avg across the blend zone of the\n          // background and content colors.\n          //\n          if (maxDist < blendDist) {\n            highp float contentWeight = (blendDist - maxDist) / blendDist;\n            gl_FragColor = mix(bgColor, contentColor, contentWeight);\n          } else {\n            // We are outside the blend zone. Just use background.\n            gl_FragColor = bgColor;\n          }\n        } else {\n          // In this condition, we are inside the content\n          highp vec4 prevLevelColor = texture2D(\n            uPrevLevelSampler,\n            vec2(vPrevLevelTextureCoord.s, vPrevLevelTextureCoord.t)\n          );\n          gl_FragColor = mix(prevLevelColor, contentColor, progress);\n        }\n      }\n      "};n.prototype.__getMaxGPUMemoryUsedBytes=function(){return this.$TiledSphericalRenderer15.getMaxGPUMemoryUsedBytes()};n.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledSphericalRenderer4};n.prototype.__createTexture=function(){this.$TiledSphericalRenderer16.createTexture()};n.prototype.__renderInternal=function(){__p&&__p();if(this.__destroyed||!this.$TiledSphericalRenderer1.isBaseLevelReady()&&!this.$TiledSphericalRenderer1.isViewportReady())return;this.__createTexture();this.$TiledSphericalRenderer7=this.$TiledSphericalRenderer6!=-1?this.$TiledSphericalRenderer6:c("performanceNow")();this.$TiledSphericalRenderer6=c("performanceNow")();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer30();var o=0,p=false;this.$TiledSphericalRenderer10.forEach(function(r){var s=this.$TiledSphericalRenderer13.get(r.getKey()),t=s?s.blendingProgress:0;if(t<1)p=true;o+=this.$TiledSphericalRenderer31(r)}.bind(this));var q=this.$TiledSphericalRenderer10.length>0?this.$TiledSphericalRenderer10.length:1;o/=q;this.$TiledSphericalRenderer4=o;if(p)this.$TiledSphericalRenderer32();else this.$TiledSphericalRenderer27()};n.prototype.$TiledSphericalRenderer32=function(){if(this.$TiledSphericalRenderer14===0)this.$TiledSphericalRenderer14=setInterval(function(){return this.$TiledSphericalRenderer33()}.bind(this),200)};n.prototype.$TiledSphericalRenderer27=function(){if(this.$TiledSphericalRenderer14!==0){clearInterval(this.$TiledSphericalRenderer14);this.$TiledSphericalRenderer14=0}};n.prototype.$TiledSphericalRenderer28=function(){var o=this.__gl.getUniformLocation(this.__shaderProgram,"uHorizontalAngleBounds"),p=this.__gl.getUniformLocation(this.__shaderProgram,"uVerticleAngleBounds"),q=this.$TiledSphericalRenderer2.partialLeftDegrees,r=this.$TiledSphericalRenderer2.partialRightDegrees,s=this.$TiledSphericalRenderer2.partialTopDegrees,t=this.$TiledSphericalRenderer2.partialBottomDegrees,u=q!==undefined&&q!==null?-1*q:-181,v=r!==undefined&&r!==null?r:181,w=t!==undefined&&t!==null?-1*t:-91,x=s!==undefined&&s!==null?s:91,y=new Float32Array([j.toRadian(u),j.toRadian(v)]),z=new Float32Array([j.toRadian(w),j.toRadian(x)]);this.__gl.uniform2fv(o,y);this.__gl.uniform2fv(p,z)};n.prototype.$TiledSphericalRenderer29=function(){__p&&__p();this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer11.clear();var o=this.$TiledSphericalRenderer34(),p=this.$TiledSphericalRenderer35(),q=Math.pow(2,o),r=2*this.$TiledSphericalRenderer3/q;for(var s=0;s<p.length;s++){var t=p[s];if(t){var u=Math.floor(t.minX/r),v=Math.min(Math.floor(t.maxX/r),q-1),w=Math.floor(t.minY/r),x=Math.min(Math.floor(t.maxY/r),q-1);for(var y=u;y<=v;y++)for(var z=w;z<=x;z++){var A=new(c("CubemapImageTileInfo"))(o,s,y,z);this.$TiledSphericalRenderer10.push(A);this.$TiledSphericalRenderer11.set(A.getKey(),true)}}}};n.prototype.$TiledSphericalRenderer30=function(){__p&&__p();this.$TiledSphericalRenderer12.forEach(function(o){var p=o.getKey();if(!this.$TiledSphericalRenderer11.has(p)){var q=this.$TiledSphericalRenderer13.get(p);if(q)q.exitView()}}.bind(this));this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer10.forEach(function(o){__p&&__p();this.$TiledSphericalRenderer12.push(o);var p=o.getKey(),q=this.$TiledSphericalRenderer13.get(p),r=this.$TiledSphericalRenderer36(o);if(!q){q=new(c("TileRendererState"))(o,r);this.$TiledSphericalRenderer13.set(p,q)}else if(!q.isInView)q.enterView(r);else{var s=this.$TiledSphericalRenderer6-this.$TiledSphericalRenderer7;if(q.shouldFetch(s))c("TiledSphericalRendererUtils").fetchImage(o,this.$TiledSphericalRenderer16.getBaseLevelTexCache(),this.$TiledSphericalRenderer16.getTextureCache(),this.$TiledSphericalRenderer1,this.$TiledSphericalRenderer37,this.$TiledSphericalRenderer6);q.update(s,r)}}.bind(this))};n.prototype.$TiledSphericalRenderer34=function(){var o=this.__verticalFieldOfView,p=this.__horizontalFieldOfView,q=this.__canvas.height/o,r=3400/2,s=0,t=this.$TiledSphericalRenderer1.getTileContentSize()/90,u=1.4;while(t*u<q&&t*o<r&&t*p<r){s++;t*=2}return Math.min(s,this.$TiledSphericalRenderer1.getMaxTileLevel())};n.prototype.$TiledSphericalRenderer35=function(){__p&&__p();var o=j.toRadian(this.__verticalFieldOfView),p=j.toRadian(this.__horizontalFieldOfView),q=1,r=Math.tan(p/2)*q,s=Math.tan(o/2)*q,t=[l.fromValues(-r,s,-q),l.fromValues(r,s,-q),l.fromValues(r,-s,-q),l.fromValues(-r,-s,-q)],u=k.create();k.invert(u,this.__rotationMatrix);c("TiledSphericalRendererUtils").rotateVec3s(u,t);var v=[];for(var w=0;w<6;w++){var x=this.$TiledSphericalRenderer18[w],y=[];for(var z=0;z<x.length;z++)y.push(l.clone(x[z]));var A=c("TiledSphericalRendererUtils").clipPolygon3D(y,t);if(A.length>0){var B=k.create();k.invert(B,this.$TiledSphericalRenderer17[w]);c("TiledSphericalRendererUtils").rotateVec3s(B,A);var C=A[0],D=C[0],E=C[0],F=C[1],G=C[1];for(var H=1;H<A.length;H++){C=A[H];D=Math.min(D,C[0]);E=Math.max(E,C[0]);F=Math.min(F,C[1]);G=Math.max(G,C[1])}v[w]={minX:this.$TiledSphericalRenderer3+D,maxX:this.$TiledSphericalRenderer3+E,minY:this.$TiledSphericalRenderer3-G,maxY:this.$TiledSphericalRenderer3-F}}}return v};n.prototype.$TiledSphericalRenderer40=function(o,p){var q=o.getKey(),r=p.get(q);if(r){this.$TiledSphericalRenderer16.cacheTexture(r);this.$TiledSphericalRenderer33()}};n.prototype.$TiledSphericalRenderer31=function(o){__p&&__p();var p=o.getKey(),q=void 0,r=void 0,s=void 0;q=this.$TiledSphericalRenderer13.get(p);if(!q)return 0;r=q.closestCoveringTile;s=q.closestPrevTile;if(!r||!s)return 0;var t=2*this.$TiledSphericalRenderer3,u=this.$TiledSphericalRenderer3,v=Math.pow(2,o.level),w=t/v,x=o.col*w,y=o.row*w,z=-u+x,A=z+w,B=u-y,C=B-w,D=[[z,B,-u],[A,B,-u],[z,C,-u],[A,C,-u]],E=this.$TiledSphericalRenderer17[o.face],F=[];for(var G=0;G<D.length;G++){l.transformMat4(D[G],D[G],E);F.push(D[G][0]);F.push(D[G][1]);F.push(D[G][2])}var H={};this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer19,F,3);this.__gl.activeTexture(this.$TiledSphericalRenderer23);if(r)H=this.$TiledSphericalRenderer43(r);else H=this.$TiledSphericalRenderer44(o);var I=this.$TiledSphericalRenderer45(o,H);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer20,I,2);this.__gl.activeTexture(this.$TiledSphericalRenderer24);var J=new(c("CubemapImageTileInfo"))(0,o.face,0,0),K=this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(J.getKey());if(!K)throw new Error("[Tile] Base level should have been loaded.");this.__gl.bindTexture(this.__gl.TEXTURE_2D,K);var L=this.$TiledSphericalRenderer45(o,J);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer21,L,2);if(q&&s){this.__gl.activeTexture(this.$TiledSphericalRenderer25);H=this.$TiledSphericalRenderer43(s);var M=this.$TiledSphericalRenderer45(o,H);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer22,M,2);var N=this.__gl.getUniformLocation(this.__shaderProgram,"progress");this.__gl.uniform1f(N,q.blendingProgress)}this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,F.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledSphericalRenderer9.forEach(function(O){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,O);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW);this.__gl.deleteBuffer(O)}.bind(this));this.$TiledSphericalRenderer9=[];return this.$TiledSphericalRenderer15.getTileToCanvasPixelRatio(H.level,this.__verticalFieldOfView)};n.prototype.$TiledSphericalRenderer42=function(o,p,q){var r=this.__gl.createBuffer();this.$TiledSphericalRenderer9.push(r);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,r);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(p),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(o,q,this.__gl.FLOAT,false,0,0)};n.prototype.$TiledSphericalRenderer45=function(o,p){var q=this.$TiledSphericalRenderer1.getTilePaddingPixels(),r=q/this.$TiledSphericalRenderer1.getTileTotalSize(),s=this.$TiledSphericalRenderer1.getTileContentSize()/this.$TiledSphericalRenderer1.getTileTotalSize(),t=Math.pow(2,o.level-p.level),u=s/t,v=o.col-t*p.col,w=o.row-t*p.row,x=r+v*u,y=r+w*u;return[x,y,x+u,y,x,y+u,x+u,y+u]};n.prototype.$TiledSphericalRenderer43=function(o){__p&&__p();var p=void 0;if(o.level===0)p={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(o.getKey())};else p=this.$TiledSphericalRenderer16.getTextureCache().get(o.getKey());if(p){this.__gl.bindTexture(this.__gl.TEXTURE_2D,p.texture);p.lastUsedTime=this.$TiledSphericalRenderer6;return o}throw new Error("No possible tile for requested params: "+o.getKey())};n.prototype.$TiledSphericalRenderer44=function(o){__p&&__p();var p=0;while(p<=o.level){var q=o.getInfoForOffsetLevel(p),r=q.getKey(),s=void 0;if(q.level===0)s={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(r)};else s=this.$TiledSphericalRenderer16.getTextureCache().get(r);if(s){this.__gl.bindTexture(this.__gl.TEXTURE_2D,s.texture);s.lastUsedTime=this.$TiledSphericalRenderer6;return q}else this.$TiledSphericalRenderer1.loadTileImage(q,this.$TiledSphericalRenderer37,this.$TiledSphericalRenderer6);p++}throw new Error("No possible tile for requested params: "+o.getKey())};n.prototype.$TiledSphericalRenderer36=function(o){var p=0;while(p<=o.level){var q=o.getInfoForOffsetLevel(p),r=q.getKey();if(this.$TiledSphericalRenderer16.getBaseLevelTexCache().has(r)||this.$TiledSphericalRenderer16.getTextureCache().has(r))return q;p++}throw new Error("No possible tile for requested params: "+o.getKey())};n.prototype.$TiledSphericalRenderer26=function(){var o=c("TiledSphericalRendererUtils").initFaceRotationMatrices(this.$TiledSphericalRenderer3),p=o.faceRotationMatrices,q=o.faceVertexLists;this.$TiledSphericalRenderer17=p;this.$TiledSphericalRenderer18=q};n.__subClassMethods={__getFragmentShaderScript:true,__getVertexShaderScript:true,__getShaderPerspectiveMatrixUniformName:true,__getShaderRotationMatrixUniformName:true,__renderInternal:true,__shaderProgramReady:true,__getMaxGPUMemoryUsedBytes:true,__getPrevFrameTextureScreenRatio:true,__createTexture:true,__clearCache:true};f.exports=n}),null);
__d("getScaledPanoDimensions",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j){__p&&__p();var k={croppedAreaImageHeightPixels:Number(i.CroppedAreaImageHeightPixels)||0,croppedAreaImageWidthPixels:Number(i.CroppedAreaImageWidthPixels)||0,croppedAreaLeftPixels:Number(i.CroppedAreaLeftPixels)||0,croppedAreaTopPixels:Number(i.CroppedAreaTopPixels)||0,fullPanoHeightPixels:Number(i.FullPanoHeightPixels)||0,fullPanoWidthPixels:Number(i.FullPanoWidthPixels)||0};if(k.croppedAreaImageWidthPixels&&j!==k.croppedAreaImageWidthPixels){var l=j/k.croppedAreaImageWidthPixels;k.croppedAreaImageWidthPixels*=l;k.croppedAreaImageHeightPixels*=l;k.croppedAreaLeftPixels*=l;k.croppedAreaTopPixels*=l;k.fullPanoHeightPixels*=l;k.fullPanoWidthPixels*=l}return k}f.exports=h}),null);
__d("SphericalPhotoRenderer.redux",["cx","Promise","Bootloader","BootloadedComponent.react","CubemapImageTileProvider","DOM","EntPhotoCubemapTileUriProvider","Event","ImageUtils","JSResource","PhotoProjection","React","SphericalMediaCanvasPool","SphericalMediaRenderer.react","StaticCubemapTileUriProvider","TiledSphericalRenderer","joinClasses","performanceNow","uniqueID","getScaledPanoDimensions","ReactRedux","SphericalMediaCoreActions","SphericalMediaViewActions","SphericalMediaBaseActions","SphericalPhotoActions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("ReactRedux").connect,l=c("SphericalMediaCoreActions").turnOff,m=c("SphericalMediaViewActions").updateViewportAndFOV,n=c("SphericalMediaBaseActions").updateBase,o=c("SphericalMediaBaseActions").setupRenderer,p=c("SphericalMediaBaseActions").webGlInitFailed,q=c("SphericalMediaBaseActions").webGlRenderFailed,r=c("SphericalMediaBaseActions").webGlContextLost,s=c("SphericalMediaBaseActions").sourceOnLoad,t=c("SphericalMediaBaseActions").viewportClicked,u=c("SphericalPhotoActions").rendererStats,v=2;i=babelHelpers.inherits(w,c("SphericalMediaRenderer.react"));j=i&&i.prototype;function w(y){j.constructor.call(this,y);this.$SphericalPhotoRenderer10=function(){this.draw(this.__getViewData())}.bind(this);this.__sourceElement=c("DOM").create("img");this.$SphericalPhotoRenderer1=c("uniqueID")();this.$SphericalPhotoRenderer2=0;this.$SphericalPhotoRenderer3=null}w.prototype.__afterDraw=function(){};w.prototype.__beforeCanvasLost=function(){this.$SphericalPhotoRenderer4();this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;if(this.props.isActive)this.props.dispatch(l())};w.prototype.__getViewData=function(){var y=this.props.viewStore.getState(),z=y.view;return{fov:z.fov,pitch:z.pitch,yaw:z.yaw}};w.prototype.__getCanvas=function(){var y=this.$SphericalPhotoRenderer5();c("SphericalMediaCanvasPool").setLimit(v,y);var z={canvasAttrs:{width:this.props.width,height:this.props.height,className:c("joinClasses")(this.props.className,"_5nxw")},beforeCanvasLost:function(){return this.__beforeCanvasLost()}.bind(this)};return c("SphericalMediaCanvasPool").get(this.$SphericalPhotoRenderer1,z,y)};w.prototype.__onSetupDone=function(){this.$SphericalPhotoRenderer6()};w.prototype.__isReadyToSetup=function(){return this.props.isActive&&this.props.imageLoaded};w.prototype.__onFallbackUIClick=function(){this.props.dispatch(t())};w.prototype.__onWebGlRenderFailed=function(y,z){this.props.dispatch(q(y,z))};w.prototype.__onWebGlContextLost=function(){this.props.dispatch(r());this.props.dispatch(l())};w.prototype.__onWebGlInitFailed=function(y){c("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.props.canvasNamespace);this.props.dispatch(p(y));this.props.dispatch(l())};w.prototype.__getRenderer=function(y){__p&&__p();return new(c("Promise"))(function(z,A){__p&&__p();var B,C=this,D=this.props,E=D.projectionType,F=D.photoSphereMetadata;if(this.props.tiledSphericalConfig.useTiledRenderer&&this.__cubemapImageTileProvider)z(new(c("TiledSphericalRenderer"))(y,this.__cubemapImageTileProvider,{partialLeftDegrees:this.props.partialLeftDegrees,partialRightDegrees:this.props.partialRightDegrees,partialTopDegrees:this.props.partialTopDegrees,partialBottomDegrees:this.props.partialBottomDegrees},F.ProjectionType===c("PhotoProjection").CYLINDRICAL));else(function(){__p&&__p();if(!C.props.imageLoaded)throw new Error("__getRenderer was called before the source has been loaded.");var G=c("getScaledPanoDimensions")(F,C.__sourceElement.width);if(E===c("PhotoProjection").EQUIRECTANGULAR)c("Bootloader").loadModules(["EquirectSphericalWebGLRenderer"],function(H){try{z(new H(this.__sourceElement,y,babelHelpers["extends"]({poseHeadingDegrees:Number(F.PoseHeadingDegrees)||0,posePitchDegrees:Number(F.PosePitchDegrees)||0,poseRollDegrees:Number(F.PoseRollDegrees)||0},G)))}catch(I){A(I)}}.bind(C),"SphericalPhotoRenderer.redux");else if(E===c("PhotoProjection").CYLINDRICAL)c("Bootloader").loadModules(["CylindricalSphericalWebGLRenderer"],function(H){try{z(new H(this.__sourceElement,y,G))}catch(I){A(I)}}.bind(C),"SphericalPhotoRenderer.redux");else c("Bootloader").loadModules(["CubestripSphericalWebGLRenderer"],function(H){try{z(new H(this.__sourceElement,y))}catch(I){A(I)}}.bind(C),"SphericalPhotoRenderer.redux")})()}.bind(this))};w.prototype.__destroy=function(){this.$SphericalPhotoRenderer4();this.$SphericalPhotoRenderer3&&this.$SphericalPhotoRenderer3();j.__destroy.call(this);c("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.$SphericalPhotoRenderer5());this.__sourceElement=c("DOM").create("img");this.__cubemapImageTileProvider=null;this.props.dispatch(n({loaded:false}))};w.prototype.$SphericalPhotoRenderer5=function(){var y=c("PhotoProjection").CUBESTRIP;if(this.props.tiledSphericalConfig.useTiledRenderer)y=c("PhotoProjection").TILED_CUBEMAP;else if(this.props.photoSphereMetadata.ProjectionType)y=this.props.photoSphereMetadata.ProjectionType;return y+this.props.canvasNamespace};w.prototype.__showLoadingThumbnail=function(){return!this.props.taggingMode};w.prototype.$SphericalPhotoRenderer4=function(){var y=this.sphericalRenderer;if(y){var z={avg_frame_render_time:y.getAverageFrameRenderTimeMillis(),avg_texture_to_screen_ratio2:y.getAverageTextureToScreenPixelRatio(),device_pixel_ratio:window.devicePixelRatio||1,dt:y.getTimeSinceFirstRenderMillis(),max_gpu_memory_used:y.getMaxGPUMemoryUsedBytes(),max_tile_level:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getMaxTileLevel():null,render_method:this.props.tiledSphericalConfig.useTiledRenderer?"tiled":"cubestrip",total_data_loaded:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getTotalPixelsLoaded():this.$SphericalPhotoRenderer7(),viewport_height:this.props.height,viewport_width:this.props.width};this.props.dispatch(u(z))}};w.prototype.$SphericalPhotoRenderer7=function(){if(this.__sourceElement&&c("ImageUtils").hasLoaded(this.__sourceElement)){var y=this.__sourceElement,z=y.width,A=y.height;return z*A}return 0};w.prototype.$SphericalPhotoRenderer8=function(y){var z,A=this,B=this.props.dispatch;c("DOM").setAttributes(this.__sourceElement,{crossOrigin:"anonymous",src:y});if(c("ImageUtils").hasLoaded(this.__sourceElement))B(s());else(function(){var C=c("Event").listen(A.__sourceElement,"load",function(){B(s());C.remove()})})()};w.prototype.$SphericalPhotoRenderer9=function(){var y=this.props,z=y.dispatch,A=y.tiledSphericalConfig;if(A.useTiledRenderer&&!this.__cubemapImageTileProvider){var B=this.props.fbid==="0"?new(c("StaticCubemapTileUriProvider"))(this.props.tiledSphericalConfig.initialTileUris):new(c("EntPhotoCubemapTileUriProvider"))(this.props.fbid,this.props.tiledSphericalConfig.initialTileUris),C=new(c("CubemapImageTileProvider"))(B,this.props.tiledSphericalConfig.maxTileLevel,this.props.tiledSphericalConfig.viewportTileUris);C.addBaseLevelReadyCallback(function(){return z(s())});this.__cubemapImageTileProvider=C}};w.prototype.$SphericalPhotoRenderer6=function(){this.$SphericalPhotoRenderer3=this.props.viewStore.subscribe(this.$SphericalPhotoRenderer10);this.draw(this.__getViewData());var y=this.sphericalRenderer;if(y){var z=c("performanceNow")()-this.$SphericalPhotoRenderer2;this.props.dispatch(o(y,z))}};w.prototype.componentDidMount=function(){var y=this.props.tiledSphericalConfig.useTiledRenderer;if(y)this.$SphericalPhotoRenderer9();else if(this.props.cubeStripImageURI)this.$SphericalPhotoRenderer8(this.props.cubeStripImageURI);if(this.props.isActive)this.$SphericalPhotoRenderer2=c("performanceNow")();j.componentDidMount.call(this)};w.prototype.componentWillReceiveProps=function(y){__p&&__p();this.shouldRender=y.isActive&&!this.props.renderer||y.isActive!==this.props.isActive||y.thumbnail!==this.props.thumbnail||y.showFallbackUI!==this.props.showFallbackUI||y.width!==this.props.width||y.height!==this.props.height||y.imageLoaded&&!this.props.imageLoaded||y.renderer!==this.props.renderer;if(this.props.fbid!==y.fbid){this.shouldRender=false;this.__destroy();return}if(y.isActive&&y.isActive!==this.props.isActive)this.$SphericalPhotoRenderer2=c("performanceNow")();if(this.props.renderer&&y.projectionType!==this.props.projectionType)this.__destroy();var z=this.props.tiledSphericalConfig.useTiledRenderer;if(z)this.$SphericalPhotoRenderer9();else if(y.cubeStripImageURI&&!this.__sourceElement.src)this.$SphericalPhotoRenderer8(y.cubeStripImageURI);j.componentWillReceiveProps.call(this,y)};w.prototype.componentWillUnmount=function(){this.props.viewStore.dispatch(m(this.props.initialYaw,this.props.initialPitch,this.props.initialFov));j.componentWillUnmount.call(this)};w.prototype.render=function(){if(this.props.useFallbackUI)return c("React").createElement("div",{onClick:function(){return this.__onFallbackUIClick()}.bind(this),role:"link",tabIndex:"0",className:"_kp_"},c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoFallbackCanvasWrapper.redux").__setRef("SphericalPhotoRenderer.redux"),bootloadPlaceholder:c("React").createElement("span",null)}));return j.render.call(this)};w.__subClassMethods={__afterDraw:true,__beforeCanvasLost:true,__getCanvas:true,__getRenderer:true,__getViewData:true,__onSetupDone:true,__isReadyToSetup:true,__onFallbackUIClick:true,__showLoadingThumbnail:true,__onWebGlContextLost:true,__onWebGlInitFailed:true,__onWebGlRenderFailed:true};var x=function x(y){return{className:y.base.className,expansionCoef:y.base.expansionCoef,fallback:y.base.fallback,height:y.base.height,initialFov:y.base.initialFov,initialPitch:y.base.initialPitch,initialYaw:y.base.initialYaw,isActive:y.base.isRendererActive||y.base.showFallbackUI,projectionType:y.base.projectionType,renderer:y.base.renderer,tiledSphericalConfig:y.base.tiledSphericalConfig,width:y.base.width,partialLeftDegrees:y.base.partialLeftDegrees,partialRightDegrees:y.base.partialRightDegrees,partialTopDegrees:y.base.partialTopDegrees,partialBottomDegrees:y.base.partialBottomDegrees,fbid:y.base.fbid,isFetchingData:y.base.isFetchingData,imageLoaded:y.base.loaded,cubeStripImageURI:y.base.src,showFallbackUI:y.base.showFallbackUI,useFallbackUI:y.base.useFallbackUI,taggingMode:y.base.taggingMode,thumbnail:y.base.thumbnail,canvasNamespace:y.base.canvasNamespace,src:y.base.src,photoSphereMetadata:y.base.photoSphereMetadata,viewStore:y.base.viewStore}};f.exports=k(x)(w)}),null);
__d("SphericalPhotoStore",["SphericalMediaBaseStore","SphericalMediaBaseReducer"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("SphericalMediaBaseStore"));i=h&&h.prototype;j.prototype.getReducers=function(){return{base:c("SphericalMediaBaseReducer")}};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("SphericalPhotoFeedEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DRAG_START:0,VIEWPORT_CLICKED:1,TAP_HEADING_INDICATOR:2})}),null);
__d("SphericalPhotoViewerLoggingMiddleware",["Banzai","Bootloader","immutable","SphericalMediaActions","SphericalPhotoConfig","collectDataAttributes","SphericalPhotoConstants","SphericalPhotoFeedEvents"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalPhotoConstants").FEED_TRACKING_KEY,i=Object.freeze({NEWSSTAND:"newsstand"}),j=Object.freeze({CONTENT_CLICK:175}),k=c("immutable").List(),l=function l(n,o,p){var q,r=c("collectDataAttributes")(n,["ft"]),s={ft:babelHelpers["extends"]((q={},q[h]=o,q),r.ft?r.ft:{})};if(p)s.ft.evt=p;c("Banzai").post("feed_tracking",s,{})},m=function m(n){__p&&__p();var o=n.getState,p=void 0,q=void 0;if(c("SphericalPhotoConfig").www_can_viewer_tag)c("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil","SphericalPhotoTagLoggingUtil"],function(r,s){p=r;q=s;k.forEach(function(t){p&&p.log(t.action,t.base);q&&q.log(t.action,t.base)});k=k.clear()},"SphericalPhotoViewerLoggingMiddleware");else c("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil"],function(r){p=r;k.forEach(function(s){p&&p.log(s.action,s.base)});k=k.clear()},"SphericalPhotoViewerLoggingMiddleware");return function(r){__p&&__p();return function(s){__p&&__p();var t=o();if(p){p.log(s,t.base);q&&q.log(s,t.base)}else k=k.push({action:s,base:t.base});if(t.base.surface===i.NEWSSTAND&&t.base.ctrElement)switch(s.type){case c("SphericalMediaActions").TAP_HEADING_INDICATOR:l(t.base.ctrElement,c("SphericalPhotoFeedEvents").TAP_HEADING_INDICATOR);break;case c("SphericalMediaActions").DRAG_START:l(t.base.ctrElement,c("SphericalPhotoFeedEvents").DRAG_START,j.CONTENT_CLICK);break}return r(s)}}};f.exports=m}),null);
__d("SphericalPhotoViewerWrapper.redux",["cx","BootloadedComponent.react","JSResource","React","ReactRedux"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("ReactRedux").connect;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement("div",{className:"_3o6m _5nxw"},this.props.children,this.props.showFallbackUI?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoFallbackIndicator.redux").__setRef("SphericalPhotoViewerWrapper.redux"),bootloadPlaceholder:c("React").createElement("span",null)}):null)};function l(){i.apply(this,arguments)}var m=function m(n){return{showFallbackUI:n.base.showFallbackUI}};f.exports=k(m)(l)}),null);
__d("SphericalPhotoViewer.react",["BootloadedComponent.react","JSResource","React","SphericalPhotoController.redux","SphericalPhotoFallbackMiddleware","SphericalPhotoViewerLoggingMiddleware","SphericalPhotoRenderer.redux","SphericalPhotoConfig","SphericalPhotoStore","SphericalPhotoViewerWrapper.redux","ReactRedux","SphericalMediaCoreActions","SphericalMediaBaseActions","SphericalMediaViewActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("ReactRedux").Provider,k=c("SphericalMediaCoreActions").turnOn,l=c("SphericalMediaCoreActions").turnOff,m=c("SphericalMediaBaseActions").updateBase,n=c("SphericalMediaBaseActions").updateDimension,o=c("SphericalMediaViewActions").updateView;h=babelHelpers.inherits(p,c("React").PureComponent);i=h&&h.prototype;function p(q){i.constructor.call(this,q);this.__store=new(c("SphericalPhotoStore"))(this.__getMiddleware()).getStore()}p.prototype.componentWillUnmount=function(){this.__store.dispatch(l())};p.prototype.componentWillMount=function(){this.__updateState();this.__store.dispatch(k())};p.prototype.componentDidUpdate=function(){this.__updateState(this.props)};p.prototype.componentWillReceiveProps=function(q){if(q.photoID!==this.__store.getState().base.fbid)this.__updateState(q)};p.prototype.__getMiddleware=function(){var q=this.props.middlewares||[];return q.concat([c("SphericalPhotoViewerLoggingMiddleware"),c("SphericalPhotoFallbackMiddleware")])};p.prototype.__updateState=function(){var q=arguments.length<=0||arguments[0]===undefined?this.props:arguments[0],r={enableGyro:q.enableGyro,enableZoom:q.enableZoom,enableRubberBanding:q.enableRubberBanding,visibility:true};if(q.partialLimits)r=babelHelpers["extends"]({},r,q.partialLimits);this.__store.dispatch(m(babelHelpers["extends"]({enableTagging:c("SphericalPhotoConfig").www_can_viewer_tag&&q.enableTagging,initialYaw:q.initialView.yaw,initialPitch:q.initialView.pitch,initialFov:q.initialView.fov,tiledSphericalConfig:q.tiledSphericalConfig,caption:q.caption,canvasNamespace:q.canvasNamespace,fallback:q.fallback,fallbackCTAElement:q.fallbackCTAElement,fbid:q.photoID,photoSphereMetadata:q.photoSphereMetadata||{},src:q.cubeImageURI,surface:q.surface,thumbnail:q.initialImageURI||"",useLargeHeadingIndicator:q.useLargeHeadingIndicator||false},r)));this.__store.dispatch(n(q.width,q.height));var s=this.__store.getState().base.viewStore;s.dispatch(o({yaw:q.initialView.yaw,pitch:q.initialView.pitch,fov:q.initialView.fov}))};p.prototype.render=function(){return c("React").createElement(j,{store:this.__store},c("React").createElement(c("SphericalPhotoViewerWrapper.redux"),null,c("React").createElement(c("SphericalPhotoRenderer.redux"),null),this.__store.getState().base.enableTagging?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoTagging.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null,c("React").createElement(c("SphericalPhotoController.redux"),null),c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoHeadingIndicator.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}),this.props.showMouseAnimation?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalMediaMouseOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null,this.props.showGyroAnimation?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalMediaGyroOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null))};p.defaultProps={canvasNamespace:"PhotoViewer",enableGyro:false,enableRubberBanding:false,enablevisibilityObserver:false,enableZoom:false,showGyroAnimation:false,showMouseAnimation:true,useLargeHeadingIndicator:false};f.exports=p}),null);
__d("SphericalPhotoViewerInFeed.react",["cx","Arbiter","Bootloader","CSS","Event","ReactDOM","SphericalMediaActions","SphericalPhotoViewer.react","SubscriptionsHandler","getElementRect","onViewportChanged","debounce","SphericalMediaCoreActions","SphericalMediaBaseActions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalMediaCoreActions").turnOn,l=c("SphericalMediaCoreActions").turnOff,m=c("SphericalMediaBaseActions").visibilityChanged,n=5e3,o=50;i=babelHelpers.inherits(p,c("SphericalPhotoViewer.react"));j=i&&i.prototype;function p(){__p&&__p();var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=j.constructor).call.apply(q,[this].concat(t)),this.$SphericalPhotoViewerInFeed6=false,this.$SphericalPhotoViewerInFeed13=function(){if(this.$SphericalPhotoViewerInFeed15())return;if(this.$SphericalPhotoViewerInFeed8&&this.$SphericalPhotoViewerInFeed8.isOpen)return;this.__store.dispatch(k())}.bind(this),this.$SphericalPhotoViewerInFeed12=c("debounce")(function(v){if(!this.$SphericalPhotoViewerInFeed5)return;var w=c("getElementRect")(this.$SphericalPhotoViewerInFeed5),x=v.bottom-v.top,y=w.bottom-w.top,z=(x-y)/3,A=v.top+z,B=v.bottom-z,C=w.top>A&&w.top<B||w.bottom>A&&w.bottom<B||A>w.top&&B<w.bottom;if(this.$SphericalPhotoViewerInFeed3!==C){this.$SphericalPhotoViewerInFeed3=C;C?this.$SphericalPhotoViewerInFeed16():this.$SphericalPhotoViewerInFeed17()}}.bind(this),o),r}p.prototype.__getMiddleware=function(){__p&&__p();var q=j.__getMiddleware.call(this),r=function(){return function(u){return function(v){if(v.type===c("SphericalMediaActions").VIEWPORT_CLICKED)this.props.theaterLinkElement&&this.props.theaterLinkElement.click();return u(v)}.bind(this)}.bind(this)}.bind(this),s=function(u){__p&&__p();var v=u.getState;return function(w){__p&&__p();return function(x){__p&&__p();var y=v().base.showFallbackUI;if(!y){if(x.type===c("SphericalMediaActions").TURN_ON)this.$SphericalPhotoViewerInFeed9();if(x.type===c("SphericalMediaActions").SETUP_RENDERER||x.type===c("SphericalMediaActions").SHOW_FALLBACK){this.$SphericalPhotoViewerInFeed10();if(this.props.initialViewElement)c("CSS").hide(this.props.initialViewElement)}}return w(x)}.bind(this)}.bind(this)}.bind(this),t=function(u){__p&&__p();var v=u.getState;return function(w){__p&&__p();return function(x){__p&&__p();var y=v().base.showFallbackUI;if(!y)if(x.type===c("SphericalMediaActions").TURN_OFF){this.$SphericalPhotoViewerInFeed3=false;c("CSS").show(this.props.loadingElement);this.$SphericalPhotoViewerInFeed11();if(this.props.initialViewElement)c("CSS").show(this.props.initialViewElement)}return w(x)}.bind(this)}.bind(this)}.bind(this);return q.concat([r,s,t])};p.prototype.componentDidMount=function(){__p&&__p();this.__updateState();this.$SphericalPhotoViewerInFeed11();var q=c("onViewportChanged")(this.$SphericalPhotoViewerInFeed12);this.$SphericalPhotoViewerInFeed1=c("Arbiter").subscribe("PhotoSnowlift.CLOSE",function(){this.$SphericalPhotoViewerInFeed3=false;q.scheduleCheck()}.bind(this));this.$SphericalPhotoViewerInFeed2=c("Arbiter").subscribe("PhotoSnowlift.OPEN",function(){c("Bootloader").loadModules(["PhotoSnowlift"],function(t){this.$SphericalPhotoViewerInFeed8=t.getInstance()}.bind(this),"SphericalPhotoViewerInFeed.react")}.bind(this));this.$SphericalPhotoViewerInFeed3=false;var r=new(c("SubscriptionsHandler"))(),s=c("ReactDOM").findDOMNode(this);r.addSubscriptions(c("Event").listen(s,"mouseenter",this.$SphericalPhotoViewerInFeed13),c("Event").listen(s,"touchstart",this.$SphericalPhotoViewerInFeed13));q.scheduleCheck();this.$SphericalPhotoViewerInFeed4=q;this.$SphericalPhotoViewerInFeed7=r;this.$SphericalPhotoViewerInFeed5=s};p.prototype.componentWillMount=function(){this.__updateState()};p.prototype.componentWillUnmount=function(){this.$SphericalPhotoViewerInFeed14();this.$SphericalPhotoViewerInFeed5=null;j.componentWillUnmount.call(this)};p.prototype.$SphericalPhotoViewerInFeed14=function(){__p&&__p();if(this.$SphericalPhotoViewerInFeed1){c("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed1);this.$SphericalPhotoViewerInFeed1=null}if(this.$SphericalPhotoViewerInFeed2){c("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed2);this.$SphericalPhotoViewerInFeed2=null}this.$SphericalPhotoViewerInFeed4&&this.$SphericalPhotoViewerInFeed4.remove();this.$SphericalPhotoViewerInFeed4=null;this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.release();this.$SphericalPhotoViewerInFeed7=null};p.prototype.$SphericalPhotoViewerInFeed9=function(){c("CSS").addClass(this.props.loadingElement,"_2dz7");c("CSS").removeClass(this.props.loadingElement,"_3s0i")};p.prototype.$SphericalPhotoViewerInFeed11=function(){c("CSS").removeClass(this.props.loadingElement,"_2dz7");c("CSS").addClass(this.props.loadingElement,"_3s0i")};p.prototype.$SphericalPhotoViewerInFeed10=function(){c("CSS").removeClass(this.props.loadingElement,"_2dz7");setTimeout(function(){return c("CSS").hide(this.props.loadingElement)}.bind(this),300)};p.prototype.$SphericalPhotoViewerInFeed15=function(){return this.__store.getState().base.isRendererActive};p.prototype.$SphericalPhotoViewerInFeed17=function(){this.$SphericalPhotoViewerInFeed11();setTimeout(function(){if(!this.$SphericalPhotoViewerInFeed3&&this.$SphericalPhotoViewerInFeed15())this.__store.dispatch(l())}.bind(this),n);this.__store.dispatch(m(false))};p.prototype.$SphericalPhotoViewerInFeed16=function(){this.$SphericalPhotoViewerInFeed13();this.__store.dispatch(m(true))};f.exports=p}),null);