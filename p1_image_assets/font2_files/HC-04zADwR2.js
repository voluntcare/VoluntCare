if (self.CavalryLogger) { CavalryLogger.start_js(["I66eb"]); }

__d("NotificationCounter",["Arbiter","CrossWindowEventEmitter","CurrentUser","DocumentTitle","FavIcon","JSLogger","MercuryConfig","MessengerEnvironment"],(function a(b,c,d,e,f,g){__p&&__p();var h=new(c("CrossWindowEventEmitter"))("JewelBase"),i={messages:0,notifications:0,requests:0},j={init:function k(){c("Arbiter").subscribe("update_title",this._handleUpdate.bind(this));c("Arbiter").subscribe("jewel/count-updated",this._handleCountUpdate.bind(this));h.addListener("count-updated",function(l){this._handleCountUpdate("",l)}.bind(this));if(c("MercuryConfig").FaviconBadge&&!c("CurrentUser").isWorkUser())c("FavIcon").setToggleResources(c("MercuryConfig").FaviconBadgedURL)},getCount:function k(){__p&&__p();var l=0;for(var m in i){var n=Number(i[m]);if(typeof i[m]=="string"&&isNaN(n))return i[m];if(isNaN(n)||n<0){c("JSLogger").create("jewels").error("bad_count",{jewel:m,count:i[m]});continue}l+=n}return l},updateTitle:function k(){if(c("MessengerEnvironment").messengerui)return;var l=this.getCount(),m=c("DocumentTitle").get();m=l?"("+l+") "+m:m;c("DocumentTitle").set(m,true);if(c("MercuryConfig").FaviconBadge)c("FavIcon").toggleSet(parseInt(l,10)>0)},_handleCountUpdate:function k(l,m){i[m.jewel]=m.count;this.updateTitle()},_handleUpdate:function k(l,m){this.updateTitle()}};f.exports=j}),null);
__d("NotificationPayloadNotificationsQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();f.exports=function(){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("WebGraphQLQueryBase"));i=h&&h.prototype;j.__getDocID=function(){"use strict";return"1493379657365213"};j.getQueryID=function(){"use strict";return"894175877424772"};function j(){"use strict";h.apply(this,arguments)}return j}()}),null);
__d("XNotificationsSyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/notifications/sync/",{lastSync:{type:"Int",required:true}})}),null);
__d("NotificationSync",["Arbiter","AsyncRequest","ChannelConstants","CurrentUser","JSLogger","NotificationConstants","NotificationPayloadNotificationsQueryWebGraphQLQuery","NotificationsDefaultEndpointURI","NotificationStore","NotificationUpdates","WebGraphQL","WebPixelRatio","XNotificationsSyncController","gkx","idx","objectValues"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("JSLogger").create("notifications"),i="channel_reload",j=0;function k(s){var t=c("NotificationUpdates").getserverTime()?c("NotificationUpdates").getserverTime():j,u=c("XNotificationsSyncController").getURIBuilder().setInt("lastSync",t).getURI();s.setHandler(l).setOption("suppressErrorAlerts",true).setErrorHandler(m).setMethod("GET").setReadOnly(true).setURI(u).setAllowCrossPageTransition(true)}function l(s){var t=s.getPayload();if(t.syncPayload)c("NotificationUpdates").handleUpdate(c("NotificationConstants").PayloadSourceType.SYNC,t.syncPayload)}function m(s){}function n(){var s=new(c("AsyncRequest"))();s.setIsBackgroundRequest(true);k(s);s.send();h.bump(i)}function o(){var s={endpointURI:c("NotificationsDefaultEndpointURI")},t=c("objectValues")(c("NotificationStore").getAll(s)),u=t.map(function(v){return v.creation_time}).filter(Boolean);if(u.length===0)return null;return Math.max.apply(Math,u)}function p(){__p&&__p();var s=o();if(s==null)return;c("WebGraphQL").exec(new(c("NotificationPayloadNotificationsQueryWebGraphQLQuery"))({environment:"WEB_DESKTOP",is_work_user:c("CurrentUser").isWorkUser(),newer_than:s,scale:c("WebPixelRatio").get(),should_fetch_buckets:false,should_fetch_sort_keys:false,should_include_server_time:false})).done(function(t){if(t){var u,v=(u=t)!=null?(u=u.viewer)!=null?(u=u.notifications)!=null?u.edges:u:u:u,w=v&&v.map(function(y){var z=y.node;return z}).filter(Boolean);if(w==null)return;var x={nodes:w};c("NotificationUpdates").handleUpdate(c("NotificationConstants").PayloadSourceType.SYNC,x)}})}function q(){c("gkx")("AT4f1HJuuuSaLQxc87QImEVA4hInCqbUAjlpUpv42ezvKujnOWPgMzPcuQFaD7GV1PtKIWxXWvJFjkQ1z9n2EHHoQq_QcjKtZLvi2Y5juArqkQ")?p():n()}var r={setup:function s(t){j=t;c("Arbiter").subscribe(c("ChannelConstants").ON_INVALID_HISTORY,q)}};f.exports=r}),null);
__d("NotificationJewelController",["Arbiter","Bootloader","Event","EventProfiler","FunnelLogger","NotificationConstants","NotificationCounter","NotificationJewelFunnelLoggingConstants","NotificationSeenState","NotificationStore","NotificationSync","NotificationUpdates","createObjectFrom","curry","isInFocusMode","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("NotificationConstants").PayloadSourceType,i=c("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_NAME,j=c("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_EVENT,k=0,l=false;function m(o){var p=c("isInFocusMode")(),q=c("NotificationSeenState").getUnseenCount();c("Arbiter").inform("jewel/count-updated",{jewel:o,count:p?0:q,animation:!p&&l&&q>0?"heart":"none"},c("Arbiter").BEHAVIOR_STATE)}function n(o,p){"use strict";__p&&__p();var q=p.badgeAnimationData,r=p.endPoint,s=p.list,t=p.startTime,u=p.unseenNotifs;if(r)c("NotificationStore").registerEndpoint({endpointURI:r});c("NotificationCounter").init();var v=false,w=null,x=c("Event").listen(o.getRoot(),"mouseover",function(){if(!v){v=true;w=c("EventProfiler").notifyRunningEagerInteraction(o.getRoot(),"click")}c("FunnelLogger").startFunnel(i);x&&x.remove();x=null;s.open();c("FunnelLogger").appendAction(i,j.MOUSE_OVER_ON_JEWEL)}),y=null;c("Event").listen(o.getRoot(),"mouseover",function(){y=c("setTimeoutAcrossTransitions")(function(){c("Bootloader").loadModules(["QE2Logger"],function(C){C.logExposureForUser("www_jewel_tooltip_experiment")},"NotificationJewelController");y=null},500)});c("Event").listen(o.getRoot(),"mouseout",function(){if(y)clearTimeout(y)});var z=false,A=o.subscribe("opened",function(){if(!z){z=true;c("EventProfiler").tagCurrentActiveInteractionsAs("FirstNotificationJewelOpen")}if(w)w();A&&A.unsubscribe();A=null;s.open()}),B=s.pause.bind(s);o.subscribe("opened",function(){setTimeout(B,0);m(o.name);c("Bootloader").loadModules(["NotificationVPVs"],function(C){return C.clearImpressions()},"NotificationJewelController");c("Arbiter").inform("notificationJewel/opened")});o.subscribe("closed",function(){s.unpause();m(o.name);c("Arbiter").inform("notificationJewel/closed")});c("NotificationUpdates").subscribe("seen-state-updated",c("curry")(m,o.name));if(q){if(q.logWithQEUniverse)c("Bootloader").loadModules(["QE2Logger"],function(C){return C.logExposureForUser(q.logWithQEUniverse)},"NotificationJewelController");if(q.injectWithAnimation)c("Bootloader").loadModules(["RelationshipDelightsBadge"],function(C){return C.inject(o,q.injectWithAnimation)},"NotificationJewelController");c("Bootloader").loadModules(["RelationshipDelightUtils"],function(C){__p&&__p();c("NotificationUpdates").subscribe("update-notifications",function(D,E){var F=E.nodes,G=E.payloadsource,H=F&&F.length?F.filter(C.shouldHeartBadge):null;if(H&&H.length){l=true;if(q.injectWithAnimation)if(G===h.INITIAL_LOAD||G===h.INITIAL_SEND)C.logBadgeAnimation(H[0].alert_id)}else l=false});if(q.logWithAlertID)C.logBadgeAnimation(q.logWithAlertID)},"NotificationJewelController")}c("NotificationUpdates").handleUpdate(h.INITIAL_LOAD,{seenState:c("createObjectFrom")(u,k)});c("NotificationSync").setup(t);m(o.name);c("NotificationUpdates").setEndPoint(r)}f.exports=n}),null);